(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[867],{391:function(e,s,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/books/refactoring",function(){return r(9894)}])},3957:function(e,s,r){"use strict";var n=r(5893);r(7294);let l={logo:(0,n.jsx)("span",{children:"Reading notes"}),project:{link:"https://github.com/mkrtchian/reading-notes"},docsRepositoryBase:"https://github.com/mkrtchian/reading-notes/blob/main",footer:{text:"Made by Roman Mkrtchian"}};s.Z=l},9894:function(e,s,r){"use strict";r.r(s),r.d(s,{default:function(){return c.ZP}});var n,l=r(5893),o=r(2720),i=r(3957);r(5513);var t=r(1151);r(5675);var c=r(1235);let a={filePath:"pages/books/refactoring.md",route:"/books/refactoring",frontMatter:{},pageMap:[{kind:"Meta",data:{index:"Introduction",books:"Reading notes"}},{kind:"Folder",name:"books",route:"/books",children:[{kind:"Meta",data:{"designing-data-intensive-applications":"Designing Data-Intensive Applications","get-your-hands-dirty-on-clean-architecture":"Get Your Hands Dirty on Clean Architecture","the-design-of-web-apis":"The Design of Web APIs","unit-testing":"Unit Testing: Principles, Practices, and Patterns","learning-domain-driven-design":"Learning Domain-Driven Design","continuous-discovery-habits":"Continuous Discovery Habits",refactoring:"Refactoring: Improving the Design of Existing Code"}},{kind:"MdxPage",name:"continuous-discovery-habits",route:"/books/continuous-discovery-habits"},{kind:"MdxPage",name:"designing-data-intensive-applications",route:"/books/designing-data-intensive-applications"},{kind:"MdxPage",name:"get-your-hands-dirty-on-clean-architecture",route:"/books/get-your-hands-dirty-on-clean-architecture"},{kind:"MdxPage",name:"learning-domain-driven-design",route:"/books/learning-domain-driven-design"},{kind:"MdxPage",name:"refactoring",route:"/books/refactoring"},{kind:"MdxPage",name:"the-design-of-web-apis",route:"/books/the-design-of-web-apis"},{kind:"MdxPage",name:"unit-testing",route:"/books/unit-testing"}]},{kind:"MdxPage",name:"index",route:"/"}],headings:[{type:"heading",depth:1,children:[{type:"text",value:"Refactoring: Improving the Design of Existing Code",position:{start:{line:1,column:3,offset:2},end:{line:1,column:53,offset:52}}}],position:{start:{line:1,column:1,offset:0},end:{line:1,column:53,offset:52}},value:"Refactoring: Improving the Design of Existing Code"},{type:"heading",depth:2,children:[{type:"text",value:"1 - Refactoring : exemple introductif",position:{start:{line:3,column:4,offset:57},end:{line:3,column:41,offset:94}}}],position:{start:{line:3,column:1,offset:54},end:{line:3,column:41,offset:94}},value:"1 - Refactoring : exemple introductif"}],flexsearch:{codeblocks:!0}};globalThis.__nextra_internal__={pageMap:a.pageMap,route:a.route};let h="Refactoring: Improving the Design of Existing Code";function x(e){let s=Object.assign({h1:"h1",h2:"h2",ul:"ul",li:"li",p:"p",em:"em",div:"div",pre:"pre",code:"code",span:"span",strong:"strong"},(0,t.ah)(),e.components);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(s.h1,{children:"Refactoring: Improving the Design of Existing Code"}),"\n",(0,l.jsx)(s.h2,{id:"1---refactoring--exemple-introductif",children:"1 - Refactoring : exemple introductif"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsx)(s.p,{children:"Ce chapitre montre un exemple de refactoring selon les techniques qui seront d\xe9crites dans le livre."}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsx)(s.p,{children:"Description :"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"Le logiciel sert une entreprise de vente de billets de pi\xe8ces de th\xe9\xe2tre, et permet de cr\xe9er des factures."}),"\n",(0,l.jsx)(s.li,{children:"Les clients pourront avoir des rabais en fonction de divers param\xe8tres (par exemple le type de la pi\xe8ce)."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsx)(s.p,{children:"Le programme :"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsx)(s.p,{children:"On a deux objets/json auxquels notre fonction a acc\xe8s :"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["Les ",(0,l.jsx)(s.em,{children:"plays"})," qui sont les pi\xe8ces de th\xe9\xe2tre.\nExemple :","\n",(0,l.jsx)(s.div,{"data-rehype-pretty-code-fragment":"",children:(0,l.jsx)(s.pre,{children:(0,l.jsxs)(s.code,{"data-language":"json","data-theme":"default",children:[(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"{"})}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:'"hamlet"'}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:":"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" { "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:'"name"'}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:":"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"Hamlet"'}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:'"type"'}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:":"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"tragedy"'}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" }"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:'"othello"'}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:":"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" { "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:'"name"'}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:":"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"Othello"'}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:'"type"'}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:":"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"tragedy"'}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" }"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})})}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["Les ",(0,l.jsx)(s.em,{children:"invoices"})," qui sont","\n",(0,l.jsx)(s.div,{"data-rehype-pretty-code-fragment":"",children:(0,l.jsx)(s.pre,{children:(0,l.jsxs)(s.code,{"data-language":"json","data-theme":"default",children:[(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"{"})}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:'"customer"'}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:":"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"BigCo"'}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:'"performances"'}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:":"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ["})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    {"})}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"      "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:'"playID"'}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:":"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"hamlet"'}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"      "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:'"audience"'}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:":"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"55"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    }"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    {"})}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"      "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:'"playID"'}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:":"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"othello"'}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"      "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:'"audience"'}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:":"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"40"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  ]"})}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsx)(s.p,{children:"Le code initial est le suivant :"}),"\n",(0,l.jsx)(s.div,{"data-rehype-pretty-code-fragment":"",children:(0,l.jsx)(s.pre,{children:(0,l.jsxs)(s.code,{"data-language":"typescript","data-theme":"default",children:[(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"statement"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(invoice"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" plays) {"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"let"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" totalAmount "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"0"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"let"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" volumeCredits "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"0"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"let"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" result "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"`Statement for "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"${"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"invoice"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:".customer"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"}"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"\\n`"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"format"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"new"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"Intl"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:".NumberFormat"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"en-US"'}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    style"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"currency"'}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    currency"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"USD"'}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    minimumFractionDigits"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"2"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  }).format;"})}),"\n",(0,l.jsx)(s.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"for"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ("}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"let"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" perf "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"of"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"invoice"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:".performances) {"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"play"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" plays["}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"perf"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:".playID];"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"let"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" thisAmount "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"0"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"switch"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ("}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"play"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:".type) {"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"      "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"case"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"tragedy"'}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:":"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        thisAmount "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"40000"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ("}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"perf"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:".audience "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:">"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"30"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:") {"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"          thisAmount "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"+="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"1000"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"*"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ("}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"perf"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:".audience "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"-"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"30"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:");"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        }"})}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"break"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"      "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"case"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"comedy"'}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:":"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        thisAmount "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"30000"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ("}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"perf"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:".audience "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:">"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"20"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:") {"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"          thisAmount "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"+="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"10000"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"+"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"500"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"*"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ("}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"perf"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:".audience "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"-"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"20"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:");"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        }"})}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        thisAmount "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"+="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"300"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"*"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"perf"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:".audience;"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"break"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"      "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"default"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:":"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"throw"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"new"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"Error"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"`unknown type: "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"${"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"play"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:".type"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"}"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"`"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:");"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// add volume credits"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    volumeCredits "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"+="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"Math"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:".max"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"perf"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:".audience "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"-"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"30"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"0"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:");"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// add extra credit for every ten comedy attendees"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ("}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"comedy"'}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"==="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"play"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:".type)"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"      volumeCredits "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"+="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"Math"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:".floor"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"perf"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:".audience "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"/"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"5"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:");"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// print line for this order"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    result "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"+="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"` "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"${"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"play"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:".name"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"}"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:": "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"${"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"format"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(thisAmount "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"/"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"100"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:")"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"}"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"`"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    result "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"+="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"` ("}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"${"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"perf"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:".audience"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"}"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:" seats)\\n`"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    totalAmount "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"+="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" thisAmount;"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  }"})}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  result "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"+="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"`Amount owed is "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"${"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"format"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(totalAmount "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"/"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"100"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:")"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"}"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"\\n`"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  result "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"+="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"`You earned "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"${"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"volumeCredits"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"}"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:" credits\\n`"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" result;"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"Le programme est court pour les besoins du livre. Pour un si petit programme la question ne se poserait peut-\xeatre pas, mais pour un programme de plusieurs centaines de lignes, il faut refactorer."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsx)(s.p,{children:"Les utilisateurs veulent deux modifications :"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"1- Afficher un relev\xe9 de compte en HTML et pas seulement sous format texte comme actuellement."}),"\n",(0,l.jsx)(s.li,{children:"2- Ajouter de nouveaux types de pi\xe8ces de th\xe9\xe2tre, avec chacune ses r\xe8gles particuli\xe8res pour le syst\xe8me de rabais. On ne sait pas encore quels types on voudra."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsx)(s.p,{children:"Une premi\xe8re (mauvaise) solution simple serait de dupliquer la fonction pour faire la version HTML sur l’autre fonction."}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"Mais il faudrait ensuite mettre \xe0 jour les r\xe8gles des nouveaux types de pi\xe8ces sur les deux fonctions."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsxs)(s.p,{children:["On va ",(0,l.jsx)(s.strong,{children:"refactorer"})," le programme :"]}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"1 - Les tests"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"Avant tout refactoring, la 1\xe8re chose \xe0 faire c’est de s’assurer que cette partie du code a des tests solides. Si c’est pas le cas on les \xe9crit."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"2 - On d\xe9compose la fonction en sortant le switch"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["On identifie d’abord \xe0 l'œil les ",(0,l.jsx)(s.strong,{children:"parties qui vont ensemble"}),"."]}),"\n",(0,l.jsx)(s.li,{children:"Ici c’est d’abord le switch qu’on choisit de traiter comme un bloc."}),"\n",(0,l.jsxs)(s.li,{children:["On va utiliser la technique ",(0,l.jsx)(s.strong,{children:"Extract Function"})," pour sortir le bloc dans une autre fonction (qui se trouvera dans la port\xe9e de ",(0,l.jsx)(s.em,{children:"statement"}),")."]}),"\n",(0,l.jsxs)(s.li,{children:["On regarde d’abord les ",(0,l.jsx)(s.strong,{children:"variables qui sont utilis\xe9es"})," par la nouvelle fonction extraite :","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["Deux variables ne sont que lues (",(0,l.jsx)(s.em,{children:"invoices"})," et ",(0,l.jsx)(s.em,{children:"plays"}),"), on va pouvoir les passer en param\xe8tre."]}),"\n",(0,l.jsxs)(s.li,{children:["Une autre variable est assign\xe9e (",(0,l.jsx)(s.em,{children:"thisAmount"}),"), on va pouvoir retourner la valeur pour l’assigner par retour de fonction."]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["Une fois qu’on a d\xe9plac\xe9 la fonction, on compile (si n\xe9cessaire), on joue les tests, et on commit.","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["Pour \xe9viter de passer du temps \xe0 d\xe9bugger son propre refactoring, il faut faire de ",(0,l.jsx)(s.strong,{children:"petites \xe9tapes avec un commit \xe0 chaque fois"}),"."]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["On va ensuite renommer la fonction, et ses param\xe8tres :","\n",(0,l.jsx)(s.div,{"data-rehype-pretty-code-fragment":"",children:(0,l.jsx)(s.pre,{children:(0,l.jsxs)(s.code,{"data-language":"typescript","data-theme":"default",children:[(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"amountFor"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(aPerformance"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" play) {"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// …"})]})]})})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["Le fait de mettre ",(0,l.jsx)(s.em,{children:"For"})," dans le nom de la fonction et ",(0,l.jsx)(s.em,{children:"a"})," dans le nom du param\xe8tre fait partie du style de Fowler, qu’il a pris \xe0 Kent Beck."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"3 - On supprime la variable play"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["Pour chaque variable prise en param\xe8tre de notre nouvelle fonction ",(0,l.jsx)(s.em,{children:"amountFor"}),", on v\xe9rifie sa provenance pour voir si on ne peut pas s’en d\xe9barrasser :","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.em,{children:"aPerformance"})," est diff\xe9rente \xe0 chaque tour de boucle, on doit la garder."]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.em,{children:"play"})," est par contre toujours le m\xeame : on pourrait le supprimer comme param\xe8tre, et recalculer sa valeur dans notre nouvelle fonction."]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["On va utiliser la technique ",(0,l.jsx)(s.strong,{children:"Replace Temp with Query"})," pour remplacer dans la boucle :","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:(0,l.jsx)(s.code,{children:"const play = plays[perf.playID];"})}),"\n",(0,l.jsx)(s.li,{children:"par"}),"\n",(0,l.jsx)(s.li,{children:(0,l.jsx)(s.code,{children:"const play = playFor(perf);"})}),"\n",(0,l.jsxs)(s.li,{children:["Avec la nouvelle fonction :","\n",(0,l.jsx)(s.div,{"data-rehype-pretty-code-fragment":"",children:(0,l.jsx)(s.pre,{children:(0,l.jsxs)(s.code,{"data-language":"typescript","data-theme":"default",children:[(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"playFor"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(aPerformance) {"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" plays["}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"aPerformance"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:".playID];"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["On compile, teste, commit, puis on utilise ",(0,l.jsx)(s.strong,{children:"Inline Variable"})," :","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["On supprime la variable ",(0,l.jsx)(s.code,{children:"const play = playFor(perf);"})]}),"\n",(0,l.jsxs)(s.li,{children:["Et on appelle la fonction au moment d’appeler ",(0,l.jsx)(s.em,{children:"amountFor"})," :","\n",(0,l.jsx)(s.div,{"data-rehype-pretty-code-fragment":"",children:(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{"data-language":"typescript","data-theme":"default",children:(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"let"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" thisAmount "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"amountFor"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(perf"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"palyFor"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(perf));"})]})})})}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["Et on fait le remplacement par l’appel partout o\xf9 ",(0,l.jsx)(s.em,{children:"play"})," \xe9tait utilis\xe9."]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["On compile, teste, commit, puis on peut utiliser ",(0,l.jsx)(s.strong,{children:"Change Function Declaration"})," pour \xe9liminer le param\xe8tre ",(0,l.jsx)(s.em,{children:"play"})," dans ",(0,l.jsx)(s.em,{children:"amountFor"})," :","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["On utilise la nouvelle fonction ",(0,l.jsx)(s.em,{children:"playFor"})," \xe0 l’int\xe9rieur d’",(0,l.jsx)(s.em,{children:"amountFor"}),", en remplacement du param\xe8tre ",(0,l.jsx)(s.em,{children:"play"}),"."]}),"\n",(0,l.jsx)(s.li,{children:"On compile, teste, commit."}),"\n",(0,l.jsxs)(s.li,{children:["On supprime le param\xe8tre ",(0,l.jsx)(s.em,{children:"play"})," qui n’\xe9tait plus utilis\xe9."]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["Remarques :","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["Faire 3 fois l’acc\xe8s \xe0 play est moins performant que de mettre la valeur dans une variable et y acc\xe9der les deux autres fois.","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["Mais ",(0,l.jsx)(s.strong,{children:"cette diff\xe9rence est n\xe9gligeable"}),"."]}),"\n",(0,l.jsxs)(s.li,{children:["Et ",(0,l.jsx)(s.strong,{children:"m\xeame si elle \xe9tait significative"}),", rendre le code plus clair permettra de mieux l’optimiser ensuite."]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Supprimer les variables locales"})," permet en g\xe9n\xe9ral de faciliter les extractions, c’est pour \xe7a qu’on le fait."]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["On utilise encore ",(0,l.jsx)(s.strong,{children:"Inline Variable"})," pour appeler plusieurs fois ",(0,l.jsx)(s.em,{children:"amountFor"})," dans ",(0,l.jsx)(s.em,{children:"statement"}),", comme \xe7a on supprime cette variable locale aussi."]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"4 - on extrait les cr\xe9dits de volume"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["On va extraire le bloc de calcul de cr\xe9dits de volume. Pour \xe7a on v\xe9rifie les variables qui devront \xeatre pass\xe9es :","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.em,{children:"perf"})," doit \xeatre pass\xe9."]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.em,{children:"play"})," a \xe9t\xe9 supprim\xe9 par le refactoring d’avant."]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.em,{children:"volumeCredits"})," est un accumulateur. On peut cr\xe9er une variable locale dans la nouvelle fonction et la retourner."]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["Ca donne :","\n",(0,l.jsx)(s.div,{"data-rehype-pretty-code-fragment":"",children:(0,l.jsx)(s.pre,{children:(0,l.jsxs)(s.code,{"data-language":"typescript","data-theme":"default",children:[(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"volumeCreditsFor"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(perf) {"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"let"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" volumeCredits "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"0"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  volumeCredits "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"+="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"Math"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:".max"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"perf"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:".audience "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"-"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"30"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"0"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:");"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ("}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"comedy"'}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"==="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"playFor"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(perf).type)"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    volumeCredits "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"+="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"Math"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:".floor"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"perf"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:".audience "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"/"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"5"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:");"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" volumeCredits;"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})})}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["Et c\xf4t\xe9 appel dans ",(0,l.jsx)(s.em,{children:"statement"})," :\n",(0,l.jsx)(s.code,{children:"volumeCredits += volumeCreditsFor(perf);"})]}),"\n",(0,l.jsx)(s.li,{children:"On compile, teste, commit."}),"\n",(0,l.jsxs)(s.li,{children:["On va renommer les variables dans ",(0,l.jsx)(s.em,{children:"volumeCreditsFor"})," :","\n",(0,l.jsx)(s.div,{"data-rehype-pretty-code-fragment":"",children:(0,l.jsx)(s.pre,{children:(0,l.jsxs)(s.code,{"data-language":"typescript","data-theme":"default",children:[(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"volumeCreditsFor"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(aPerformance) {"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"let"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" result "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"0"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  result "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"+="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"Math"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:".max"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"aPerformance"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:".audience "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"-"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"30"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"0"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:");"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ("}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"comedy"'}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"==="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"playFor"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(aPerformance).type)"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    result "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"+="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"Math"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:".floor"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"aPerformance"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:".audience "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"/"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"5"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:");"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" result;"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["On a ici fait deux changements de variable (",(0,l.jsx)(s.em,{children:"aPerformance"}),", et ",(0,l.jsx)(s.em,{children:"result"}),"), il faut compiler, tester et commiter entre chaque changement."]}),"\n",(0,l.jsxs)(s.li,{children:["La convention ",(0,l.jsx)(s.em,{children:"result"})," fait partie du style de convention de Martin Fowler, au m\xeame titre que ",(0,l.jsx)(s.em,{children:"aVariable"})," pour les variables en param\xe8tre."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"5 - On va supprimer la variable format"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["On continue \xe0 supprimer des variables temporaires dans ",(0,l.jsx)(s.em,{children:"statement"})," pour faciliter l’extraction de blocs."]}),"\n",(0,l.jsxs)(s.li,{children:["Ici on s’attaque \xe0 ",(0,l.jsx)(s.em,{children:"format"}),", c’est une variable contenant une fonction. On va la supprimer pour d\xe9clarer la fonction en question :","\n",(0,l.jsx)(s.div,{"data-rehype-pretty-code-fragment":"",children:(0,l.jsx)(s.pre,{children:(0,l.jsxs)(s.code,{"data-language":"typescript","data-theme":"default",children:[(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"format"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(aNumber) {"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"new"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"Intl"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:".NumberFormat"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"en-US"'}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    style"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"currency"'}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    currency"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"USD"'}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    minimumFractionDigits"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"2"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  })"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:".format"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(aNumber);"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})})}),"\n"]}),"\n",(0,l.jsx)(s.li,{children:"Cette technique de transformer une fonction dans une variable en fonction d\xe9clar\xe9e n’est pas assez importante pour figurer dans les techniques du livre."}),"\n",(0,l.jsxs)(s.li,{children:["On va ensuite utiliser ",(0,l.jsx)(s.strong,{children:"Change Function Declaration"})," pour renommer la fonction en quelque chose qui indique mieux ce qu’elle fait.","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["Vu qu’elle est utilis\xe9e dans une petite port\xe9e et est peu importante, Fowler privil\xe9gie un nom plus court que ",(0,l.jsx)(s.em,{children:"formatAsUSD"}),". Il choisit juste ",(0,l.jsx)(s.em,{children:"usd"})," pour mettre en avant l’aspect mon\xe9taire."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"6 - On va d\xe9placer le calcul du volume de cr\xe9dits"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["On avait pr\xe9c\xe9demment extrait le calcul du volume de cr\xe9dits pour une pi\xe8ce. On va maintenant extraire le calcul du volume de cr\xe9dits pour l’ensemble des pi\xe8ces hors de ",(0,l.jsx)(s.em,{children:"statement"}),"."]}),"\n",(0,l.jsxs)(s.li,{children:["On va utiliser ",(0,l.jsx)(s.strong,{children:"Split Loop"})," pour couper la boucle en deux, et avoir le calcul du volume de cr\xe9dits dans une boucle \xe0 part.","\n",(0,l.jsx)(s.div,{"data-rehype-pretty-code-fragment":"",children:(0,l.jsx)(s.pre,{children:(0,l.jsxs)(s.code,{"data-language":"typescript","data-theme":"default",children:[(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"for"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ("}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"let"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" perf "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"of"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"invoice"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:".performances) {"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// print line for this order"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  result "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"+="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"` "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"${"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"play"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:".name"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"}"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:": "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"${"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"format"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(thisAmount "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"/"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"100"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:")"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"}"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"`"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  result "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"+="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"` ("}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"${"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"perf"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:".audience"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"}"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:" seats)\\n`"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  totalAmount "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"+="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" thisAmount;"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"for"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ("}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"let"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" perf "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"of"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"invoice"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:".performances) {"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  volumeCredits "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"+="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"volumeCreditsFor"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(perf);"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"On compile, teste, commit."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["On peut alors utiliser ",(0,l.jsx)(s.strong,{children:"Slide Statements"})," pour d\xe9placer la d\xe9claration de la variable ",(0,l.jsx)(s.em,{children:"volumeCredits"})," juste au-dessus de la 2\xe8me boucle.","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"On compile, teste, commit."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["On va pouvoir utiliser ",(0,l.jsx)(s.strong,{children:"Replace Temp with Query"}),", la premi\xe8re \xe9tape pour pouvoir le faire c’est d’utiliser ",(0,l.jsx)(s.strong,{children:"Extract Function"})," :","\n",(0,l.jsx)(s.div,{"data-rehype-pretty-code-fragment":"",children:(0,l.jsx)(s.pre,{children:(0,l.jsxs)(s.code,{"data-language":"typescript","data-theme":"default",children:[(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"totalVolumeCredits"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"() {"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"let"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" volumeCredits "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"0"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"for"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ("}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"let"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" perf "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"of"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"invoice"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:".performances) {"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    volumeCredits "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"+="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"volumeCreditsFor"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(perf);"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  }"})}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" volumeCredits;"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})})}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["On peut donc appeler la nouvelle fonction dans statement :","\n",(0,l.jsx)(s.div,{"data-rehype-pretty-code-fragment":"",children:(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{"data-language":"typescript","data-theme":"default",children:(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"volumeCredits "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"totalVolumeCredits"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"();"})]})})})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"On compile, teste, commit."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["On peut alors utiliser ",(0,l.jsx)(s.strong,{children:"Inline Variable"})," pour supprimer la variable locale ",(0,l.jsx)(s.em,{children:"volumeCredits"}),", et appeler ",(0,l.jsx)(s.em,{children:"totalVolumeCredits"})," l\xe0 o\xf9 elle \xe9tait utilis\xe9e.","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"On compile, teste, commit."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["Remarques :","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["Pour le c\xf4t\xe9 ",(0,l.jsx)(s.strong,{children:"performance"}),", la plupart du temps cr\xe9er des boucles suppl\xe9mentaires ne cr\xe9era pas de ralentissement significatif.","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"M\xeame dans les rares cas o\xf9 c’est le cas, on pourra toujours mieux optimiser apr\xe8s avoir rendu le code plus clair par du refactoring."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["Les \xe9tapes pr\xe9sent\xe9es avant chaque compilation/test/commit sont tr\xe8s courtes. Il arrive \xe0 Martin Fowler de ne pas faire \xe0 chaque fois des \xe9tapes aussi courtes, mais il fait quand m\xeame des \xe9tapes relativement courtes.","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["Et surtout, d\xe8s que les tests \xe9chouent, il ",(0,l.jsx)(s.strong,{children:"annule ce qu’il a fait depuis le dernier commit"})," et reprend avec des \xe9tapes plus courtes (comme celles-l\xe0)."]}),"\n",(0,l.jsxs)(s.li,{children:["Le but c’est de ne pas ",(0,l.jsx)(s.strong,{children:"perdre de temps \xe0 d\xe9bugger"})," pendant un refactoring."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["On va r\xe9p\xe9ter la m\xeame s\xe9quence pour extraire compl\xe8tement ",(0,l.jsx)(s.em,{children:"totalAmount"})," :","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Split Loop"})," pour extraire l’instruction qui nous int\xe9resse dans une boucle \xe0 part."]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Slide Statements"})," pour d\xe9placer la variable locale pr\xe8s de la nouvelle boucle."]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Extract Function"})," pour extraire la boucle dans une nouvelle fonction.","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["Le meilleur nom pour cette fonction est d\xe9j\xe0 pris par la variable ",(0,l.jsx)(s.em,{children:"totalAmount"}),", donc on lui met un nom au hasard pour garder un code qui marche et commiter."]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Inline Variable"})," nous permet d’\xe9liminer la variable locale, et de renommer la nouvelle fonction ",(0,l.jsx)(s.em,{children:"totalAmount"}),"."]}),"\n",(0,l.jsxs)(s.li,{children:["On en profite aussi pour renommer la variable locale dans la nouvelle fonction en ",(0,l.jsx)(s.em,{children:"result"})," pour respecter notre convention de nommage."]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["Ca donne :","\n",(0,l.jsx)(s.div,{"data-rehype-pretty-code-fragment":"",children:(0,l.jsx)(s.pre,{children:(0,l.jsxs)(s.code,{"data-language":"typescript","data-theme":"default",children:[(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"totalAmount"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"() {"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"let"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" result "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"0"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"for"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ("}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"let"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" perf "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"of"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"invoice"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:".performances) {"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    result "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"+="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"amountFor"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(perf);"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  }"})}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" result;"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"7 - On va fractionner les phases de calcul et de formatage"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsx)(s.p,{children:"Jusqu’ici on avait refactor\xe9 pour rendre le code plus clair et mieux le comprendre. On va maintenant le mener vers l’objectif qui est de pouvoir cr\xe9er des factures HTML en plus des factures texte."}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsxs)(s.p,{children:["On va mettre en œuvre ",(0,l.jsx)(s.strong,{children:"Split Phase"})," pour faire la division logique / formatage."]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsxs)(s.p,{children:["Pour \xe7a on commence par appliquer ",(0,l.jsx)(s.strong,{children:"Extract Function"})," au code qui constituera la 2\xe8me phase : on va d\xe9placer l’ensemble du code de ",(0,l.jsx)(s.em,{children:"statement"})," et les fonctions imbriqu\xe9es dans une fonction ",(0,l.jsx)(s.em,{children:"renderPlainText"}),"."]}),"\n",(0,l.jsx)(s.div,{"data-rehype-pretty-code-fragment":"",children:(0,l.jsx)(s.pre,{children:(0,l.jsxs)(s.code,{"data-language":"typescript","data-theme":"default",children:[(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"statement"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(invoice"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" plays) {"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"renderplainText"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(invoice"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" plays);"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,l.jsx)(s.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"renderPlainText"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(invoice"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" plays) {"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"let"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" result "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"`Statement for "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"${"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"invoice"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:".customer"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"}"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"\\n`"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// ..."})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" result;"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"totalAmount"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"() {"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// ..."})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  }"})}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// ..."})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"On compile, teste et commit."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsxs)(s.p,{children:["On va cr\xe9er un objet qui servira de ",(0,l.jsx)(s.strong,{children:"structure de donn\xe9es interm\xe9diaire entre les deux phases"})," :"]}),"\n",(0,l.jsx)(s.div,{"data-rehype-pretty-code-fragment":"",children:(0,l.jsx)(s.pre,{children:(0,l.jsxs)(s.code,{"data-language":"typescript","data-theme":"default",children:[(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"statement"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(invoice"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" plays) {"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"statementData"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" {};"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"renderplainText"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(statementData"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" invoice"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" plays);"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,l.jsx)(s.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"renderPlainText"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(data"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" invoice"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" plays) {"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"//..."})})]})})}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsxs)(s.p,{children:["Le but c’est de d\xe9placer tout le calcul de logique hors de ",(0,l.jsx)(s.em,{children:"renderPlainText"}),", et de tout lui passer au travers de l’objet ",(0,l.jsx)(s.em,{children:"data"}),"."]}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsx)(s.p,{children:"(On va compiler / tester / commiter entre chaque \xe9tape)"}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsxs)(s.p,{children:["On va mettre ",(0,l.jsx)(s.code,{children:"invoice.customer"})," dans ",(0,l.jsx)(s.em,{children:"data"}),", pour obtenir ",(0,l.jsx)(s.code,{children:"data.customer"})," de l’autre c\xf4t\xe9."]}),"\n",(0,l.jsx)(s.div,{"data-rehype-pretty-code-fragment":"",children:(0,l.jsx)(s.pre,{children:(0,l.jsxs)(s.code,{"data-language":"typescript","data-theme":"default",children:[(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"statementData"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" {};"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"statementData"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:".customer "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"invoice"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:".customer;"})]})]})})}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsxs)(s.p,{children:["On fait pareil avec ",(0,l.jsx)(s.code,{children:"invoice.performances"}),"."]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsxs)(s.p,{children:["On veut maintenant que les valeurs des performances soient pr\xe9calcul\xe9es dans le param\xe8tre ",(0,l.jsx)(s.em,{children:"data"})," qu’on donne \xe0 ",(0,l.jsx)(s.em,{children:"renderPlainText"}),". On commence par cr\xe9er une fonction pour enrichir les performances :"]}),"\n",(0,l.jsx)(s.div,{"data-rehype-pretty-code-fragment":"",children:(0,l.jsx)(s.pre,{children:(0,l.jsxs)(s.code,{"data-language":"typescript","data-theme":"default",children:[(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"statementData"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:".performances "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"invoice"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"."}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"performances"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:".map"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(enrichPerformance);"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"enrichPerformance"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(aPerformance) {"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"result"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" { "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"..."}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"aPerformance };"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" result;"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})})}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsxs)(s.p,{children:["On va d\xe9placer les informations des pi\xe8ces (plays) dans les ",(0,l.jsx)(s.em,{children:"performances"})," qu’on a mis dans ",(0,l.jsx)(s.em,{children:"data"}),"."]}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["Pour \xe7a on ajoute la valeur dans notre nouvelle fonction.","\n",(0,l.jsx)(s.div,{"data-rehype-pretty-code-fragment":"",children:(0,l.jsx)(s.pre,{children:(0,l.jsxs)(s.code,{"data-language":"typescript","data-theme":"default",children:[(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"enrichPerformance"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(aPerformance) {"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"result"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" { "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"..."}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"aPerformance };"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"result"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:".play "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"playFor"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(result);"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" result;"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})})}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["Ensuite on utilise ",(0,l.jsx)(s.strong,{children:"Move Function"})," pour d\xe9placer ",(0,l.jsx)(s.em,{children:"playFor"})," en dessous d’",(0,l.jsx)(s.em,{children:"enrichPerformance"}),"."]}),"\n",(0,l.jsxs)(s.li,{children:["Et enfin on remplace toutes les utilisations de ",(0,l.jsx)(s.em,{children:"playFor"})," dans les fonctions de ",(0,l.jsx)(s.em,{children:"renderPlainText"})," par les valeurs pr\xe9calcul\xe9es issues de ",(0,l.jsx)(s.em,{children:"data"}),". On va y acc\xe9der typiquement par ",(0,l.jsx)(s.code,{children:"perf.play"}),"."]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsxs)(s.p,{children:["On va ensuite appliquer la m\xeame chose que pour ",(0,l.jsx)(s.em,{children:"playFor"}),", mais cette fois pour ",(0,l.jsx)(s.em,{children:"amountFor"})," dont on \xe9limine les appels de ",(0,l.jsx)(s.em,{children:"renderPlainText"}),"."]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsxs)(s.p,{children:["Puis on fait la m\xeame chose pour ",(0,l.jsx)(s.em,{children:"volumeCreditsFor"}),"."]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsxs)(s.p,{children:["Et encore la m\xeame chose pour ",(0,l.jsx)(s.em,{children:"totalAmount"}),", et ",(0,l.jsx)(s.em,{children:"totalVolumeCredits"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsxs)(s.p,{children:["On en profite pour utiliser ",(0,l.jsx)(s.strong,{children:"Replace Loop with Pipeline"})," sur les boucles de ",(0,l.jsx)(s.em,{children:"totalAmount"})," et ",(0,l.jsx)(s.em,{children:"totalVolumeCredits"}),"."]}),"\n",(0,l.jsx)(s.div,{"data-rehype-pretty-code-fragment":"",children:(0,l.jsx)(s.pre,{children:(0,l.jsxs)(s.code,{"data-language":"typescript","data-theme":"default",children:[(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"totalAmount"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(data) {"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"data"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"."}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"performances"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:".reduce"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"((total"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" p) "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"=>"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" total "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"+"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"p"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:".amount"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"0"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:");"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})})}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsx)(s.p,{children:"On va maintenant extraire le code de premi\xe8re phase qu’on vient de cr\xe9er (la cr\xe9ation des data pr\xe9-calcul\xe9es dans statement) dans une fonction \xe0 part :"}),"\n",(0,l.jsx)(s.div,{"data-rehype-pretty-code-fragment":"",children:(0,l.jsx)(s.pre,{children:(0,l.jsxs)(s.code,{"data-language":"typescript","data-theme":"default",children:[(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"statement"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(invoice"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" plays) {"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"renderplainText"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"createStatementData"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(invoice"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" plays)"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  );"})}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,l.jsx)(s.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"renderPlainText"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(data) {"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"//..."})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,l.jsx)(s.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"createStatementData"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(invoice"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" plays) {"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"result"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" {};"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"result"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:".customer "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"invoice"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:".customer;"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"result"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:".performances "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"      "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"invoice"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"."}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"performances"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:".map"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(enrichPerformance);"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"result"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:".totalAmount "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"totalAmount"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(result);"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"result"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:".totalVolumeCredits "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"      "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"totalVolumeCredits"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(result);"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" result;"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"enrichPerformance"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(aPerformance) {"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// ..."})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  }"})}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// ..."})})]})})}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsxs)(s.p,{children:["On peut alors extraire ",(0,l.jsx)(s.em,{children:"createStatementData"})," et ses fonctions imbriqu\xe9es (le code de la phase 1 donc) dans un fichier \xe0 part qu’on appelle ",(0,l.jsx)(s.em,{children:"createStatementData.js"}),"."]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsx)(s.p,{children:"On peut maintenant facilement \xe9crire la version HTML de statement dans le fichier statement.js :"}),"\n",(0,l.jsx)(s.div,{"data-rehype-pretty-code-fragment":"",children:(0,l.jsx)(s.pre,{children:(0,l.jsxs)(s.code,{"data-language":"typescript","data-theme":"default",children:[(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"statement"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(invoice"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" plays) {"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"renderplainText"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"createStatementData"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(invoice"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" plays));"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,l.jsx)(s.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"renderPlainText"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(data) {"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"let"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" result "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"`Statement for "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"${"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"data"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:".customer"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"}"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"\\n`"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// ..."})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" result;"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,l.jsx)(s.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"htmlStatement"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(invoice"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" plays) {"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"renderHtml"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"createStatementData"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(invoice"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" plays));"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,l.jsx)(s.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"renderHtml"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(data) {"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"let"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" result "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"`<h1>Statement for "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"${"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"data"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:".customer"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"}"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"</h1>\\n`"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// ..."})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" result;"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})})}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsxs)(s.p,{children:["Remarque : Fowler propose de suivre la ",(0,l.jsx)(s.strong,{children:"r\xe8gle du camping"})," : il faut toujours laisser le code un peu plus propre que l’\xe9tat dans lequel on l’a trouv\xe9. Le code ne sera jamais parfait, mais il sera meilleur qu’avant."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"8 - On va cr\xe9er un calculateur pour types de performances"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsx)(s.p,{children:"On s’int\xe9resse ici au fait de faciliter l’ajout de nouveaux types de pi\xe8ces de th\xe9\xe2tre, avec chacun ses conditions et valeurs de calcul pour la facturation et les cr\xe9dits de volume."}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsxs)(s.p,{children:["La solution qu’on retient c’est de cr\xe9er un calculateur sous forme de classes, avec des classes filles pour contenir la logique de chaque type de pi\xe8ce. On va donc mettre en œuvre la technique ",(0,l.jsx)(s.strong,{children:"Replace Conditional with Polymorphism"}),"."]}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["NDLR : dans Clean Code, Uncle Bob disait qu’un code proc\xe9dural (qui utilise les structures de donn\xe9es pour repr\xe9senter les objets) est adapt\xe9 pour ajouter des fonctionnalit\xe9s suppl\xe9mentaires (par exemple dans notre cas une fonctionnalit\xe9 en plus du calcul de facturation et du calcul de volume de cr\xe9dits). Un code orient\xe9 objet par contre est plut\xf4t adapt\xe9 pour l’ajout de nouveaux types d’objets sans ajout de nouvelles fonctionnalit\xe9s (par exemple dans notre cas ajouter un nouveau type de pi\xe8ce de th\xe9\xe2tre avec ses propres r\xe8gles de facturation et volume de cr\xe9dits).","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"L’id\xe9e est de minimiser le nombre d’\xe9l\xe9ments qui seront chang\xe9s quand on fera notre changement."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsx)(s.p,{children:"On commence par cr\xe9er le calculateur sans qu’il ne fasse rien :"}),"\n",(0,l.jsx)(s.div,{"data-rehype-pretty-code-fragment":"",children:(0,l.jsx)(s.pre,{children:(0,l.jsxs)(s.code,{"data-language":"typescript","data-theme":"default",children:[(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"enrichPerformance"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(aPerformance) {"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"calculator"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"new"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"PerformanceCalculator"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(aPerformance);"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// ..."})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,l.jsx)(s.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"class"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"PerformanceCalculator"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"constructor"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(aPerformance) {"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"this"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:".performance "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" aPerformance;"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  }"})}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})})}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsx)(s.p,{children:"Ensuite, pour plus de clart\xe9, on d\xe9place les informations des pi\xe8ces :"}),"\n",(0,l.jsx)(s.div,{"data-rehype-pretty-code-fragment":"",children:(0,l.jsx)(s.pre,{children:(0,l.jsxs)(s.code,{"data-language":"typescript","data-theme":"default",children:[(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"enrichPerformance"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(aPerformance) {"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"calculator"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"new"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"PerformanceCalculator"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    aPerformance"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"playFor"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(aPerformance)"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  );"})}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// ..."})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,l.jsx)(s.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"class"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"PerformanceCalculator"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"constructor"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(aPerformance"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" aPlay) {"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"this"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:".performance "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" aPerformance;"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"this"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:".play "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" aPlay;"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  }"})}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"9 - On va d\xe9placer les fonctions de calcul dans le calculateur"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["On va d’abord d\xe9placer ",(0,l.jsx)(s.em,{children:"amountFor"})," dans le calculateur.","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["Pour \xe7a on commence par utiliser ",(0,l.jsx)(s.strong,{children:"Move Function"})," et copier le code dans un getter, et utiliser les variables d’instance ",(0,l.jsx)(s.code,{children:"this.play"})," et ",(0,l.jsx)(s.code,{children:"this.performance"})," :","\n",(0,l.jsx)(s.div,{"data-rehype-pretty-code-fragment":"",children:(0,l.jsx)(s.pre,{children:(0,l.jsxs)(s.code,{"data-language":"typescript","data-theme":"default",children:[(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"get "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"amount"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"() {"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"switch"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ("}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"this"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"."}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"play"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:".type) {"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"case"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"tragedy"'}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:":"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    thisAmount "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"40000"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ("}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"this"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"."}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"performance"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:".audience "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:">"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"30"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:") {"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"//..."})}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})})}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["On va ensuite instancier le calculateur et utiliser le getter ",(0,l.jsx)(s.em,{children:"amount"})," dans ",(0,l.jsx)(s.em,{children:"amountFor"}),", pour tester que jusque l\xe0 les tests passent.","\n",(0,l.jsx)(s.div,{"data-rehype-pretty-code-fragment":"",children:(0,l.jsx)(s.pre,{children:(0,l.jsxs)(s.code,{"data-language":"typescript","data-theme":"default",children:[(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"amountFor"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(aPerformance) {"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"new"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"PerformanceCalculator"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(aPerformance"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"playFor"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(aPerformance))"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    .amount;"})}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})})}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["Enfin on va utiliser ",(0,l.jsx)(s.strong,{children:"Inline Function"})," pour \xe9liminer ",(0,l.jsx)(s.em,{children:"amountFor"})," et utiliser ",(0,l.jsx)(s.code,{children:"calculator.amount"})," \xe0 la place."]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["On fait la m\xeame chose pour ",(0,l.jsx)(s.em,{children:"volumeCreditsFor"}),", pour se retrouver \xe0 utiliser ",(0,l.jsx)(s.code,{children:"calculator.volumeCredits"}),"."]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"10 - On va rendre le calculateur polymorphe"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsxs)(s.p,{children:["On va commencer par utiliser ",(0,l.jsx)(s.strong,{children:"Replace Type Code with Subclasses"})," pour \xe7a."]}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsxs)(s.p,{children:["Pour obtenir la bonne classe, on va utiliser ",(0,l.jsx)(s.strong,{children:"Replace Constructor with Factory Function"})," :"]}),"\n",(0,l.jsx)(s.div,{"data-rehype-pretty-code-fragment":"",children:(0,l.jsx)(s.pre,{children:(0,l.jsxs)(s.code,{"data-language":"typescript","data-theme":"default",children:[(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"enrichPerformance"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(aPerformance) {"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"calculator"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"createPerformanceCalculator"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    aPerformance"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"playFor"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(aPerformance)"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  );"})}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"//..."})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,l.jsx)(s.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"createPerformanceCalculator"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(aPerformance"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" aPlay) {"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"switch"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ("}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"aPlay"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:".type) {"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"case"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"tragedy"'}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:":"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"      "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"TragedyCalculator"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(aPerformance"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" aPlay);"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"case"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"comedy"'}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:":"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"      "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"ComedyCalculator"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(aPerformance"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" aPlay);"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"default"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:":"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"      "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"throw"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"new"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"Error"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"`Unknown type: "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"${"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"aPlay"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:".type"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"}"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"`"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:");"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  }"})}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,l.jsx)(s.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"class"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"TragedyCalculator"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"extends"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"PerformanceCalculator"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" {}"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"class"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"ComedyCalculator"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"extends"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"PerformanceCalculator"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" {}"})]})]})})}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsxs)(s.p,{children:["On peut maintenant utiliser ",(0,l.jsx)(s.strong,{children:"Replace Conditional with Polymorphism"})," pour d\xe9placer les fonctions de calcul dans les classes filles."]}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["On peut cr\xe9er un getter du m\xeame nom (",(0,l.jsx)(s.em,{children:"amount"}),") dans ",(0,l.jsx)(s.em,{children:"TragedyCalculator"})," par exemple, pour y d\xe9placer le code li\xe9 \xe0 la facturation des trag\xe9dies."]}),"\n",(0,l.jsx)(s.li,{children:"Puis on le fait pour la facturation des com\xe9dies."}),"\n",(0,l.jsxs)(s.li,{children:["On peut alors supprimer ",(0,l.jsx)(s.code,{children:"get amount()"})," de ",(0,l.jsx)(s.em,{children:"PerformanceCalculator"}),". Ou alors le laisser et y throw une erreur indiquant que la fonctionnalit\xe9 est d\xe9l\xe9gu\xe9e aux classes filles."]}),"\n",(0,l.jsxs)(s.li,{children:["On peut faire pareil avec les volumes de cr\xe9dits. Pour celui-l\xe0 on pourra laisser le cas le plus courant (attribuer des cr\xe9dits si l’auditoire est sup\xe9rieur \xe0 30 personnes) dans ",(0,l.jsx)(s.em,{children:"PerformanceCalculator"}),", et ne surcharger que pour ",(0,l.jsx)(s.em,{children:"ComedyCalculator"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsxs)(s.p,{children:["Comme souvent, ",(0,l.jsx)(s.strong,{children:"les premi\xe8res phases"})," du refactoring permettent de ",(0,l.jsx)(s.strong,{children:"comprendre"})," ce que fait le code en le clarifiant. On peut ensuite r\xe9injecter cette compr\xe9hension dans la suite des refactorings pour le faire aller dans le sens qu’on veut."]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsxs)(s.p,{children:["Les ",(0,l.jsx)(s.strong,{children:"petites \xe9tapes"})," sont \xe9tonnantes au premier abord, mais cette m\xe9thode est vraiment efficace, et permet d’avancer sereinement et rapidement pour faire au final des refactorings importants."]}),"\n"]}),"\n"]})]})}function d(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:s}=Object.assign({},(0,t.ah)(),e.components);return s?(0,l.jsx)(s,{...e,children:(0,l.jsx)(x,{...e})}):x(e)}a.title="string"==typeof h&&h||"Refactoring: Improving the Design of Existing Code";let p=e=>(0,l.jsx)(o.mK.Provider,{value:e,children:(0,l.jsx)(d,{})});(n=globalThis).__nextra_pageContext__||(n.__nextra_pageContext__=Object.create(null)),globalThis.__nextra_pageContext__["/books/refactoring"]={Content:p,pageOpts:a,themeConfig:i.Z}}},function(e){e.O(0,[774,860,888,179],function(){return e(e.s=391)}),_N_E=e.O()}]);