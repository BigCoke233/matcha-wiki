<!DOCTYPE html><html><head><meta charSet="utf-8"/><title>Get Your Hands Dirty on Clean Architecture – Reading notes</title><meta name="robots" content="index,follow"/><meta name="description" content="My detailed reading notes from computer science books"/><meta property="og:title" content="Get Your Hands Dirty on Clean Architecture – Reading notes"/><meta property="og:description" content="My detailed reading notes from computer science books"/><meta name="theme-color" content="#111111" media="(prefers-color-scheme: dark)"/><meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/><style>
        :root {
          --nextra-primary-hue: 212deg;
          --nextra-navbar-height: 4rem;
          --nextra-menu-height: 3.75rem;
          --nextra-banner-height: 2.5rem;
        }
        
        .dark {
          --nextra-primary-hue: 204deg;
        }
      </style><meta name="msapplication-TileColor" content="#fff"/><meta http-equiv="Content-Language" content="en"/><meta name="description" content="My detailed reading notes from computer science books"/><meta property="og:title" content="Reading notes"/><meta property="og:description" content="My detailed reading notes from computer science books"/><meta name="apple-mobile-web-app-title" content="Reading notes"/><link rel="icon" type="image/x-icon" href="/reading-notes/favicon.ico"/><meta name="next-head-count" content="16"/><link rel="preload" href="/reading-notes/_next/static/css/c5c3ea6ba6c3cfc3.css" as="style"/><link rel="stylesheet" href="/reading-notes/_next/static/css/c5c3ea6ba6c3cfc3.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/reading-notes/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/reading-notes/_next/static/chunks/webpack-20800fb497bc91cf.js" defer=""></script><script src="/reading-notes/_next/static/chunks/framework-114634acb84f8baa.js" defer=""></script><script src="/reading-notes/_next/static/chunks/main-914cdfb692f69e87.js" defer=""></script><script src="/reading-notes/_next/static/chunks/pages/_app-df511a3677d160f6.js" defer=""></script><script src="/reading-notes/_next/static/chunks/860-51b101836d64d13d.js" defer=""></script><script src="/reading-notes/_next/static/chunks/pages/books/get-your-hands-dirty-on-clean-architecture-1e630c1b3bd3c7d8.js" defer=""></script><script src="/reading-notes/_next/static/fSnU8rZPKXAFKq-757ygu/_buildManifest.js" defer=""></script><script src="/reading-notes/_next/static/fSnU8rZPKXAFKq-757ygu/_ssgManifest.js" defer=""></script></head><body><div id="__next"><script>!function(){try{var d=document.documentElement,c=d.classList;c.remove('light','dark');var e=localStorage.getItem('theme');if('system'===e||(!e&&true)){var t='(prefers-color-scheme: dark)',m=window.matchMedia(t);if(m.media!==t||m.matches){d.style.colorScheme = 'dark';c.add('dark')}else{d.style.colorScheme = 'light';c.add('light')}}else if(e){c.add(e|| '')}if(e==='light'||e==='dark')d.style.colorScheme=e}catch(e){}}()</script><div dir="ltr"><script>document.documentElement.setAttribute('dir','ltr')</script><div class="nextra-nav-container nx-sticky nx-top-0 nx-z-20 nx-w-full nx-bg-transparent"><div class="nextra-nav-container-blur nx-pointer-events-none nx-absolute nx-z-[-1] nx-h-full nx-w-full nx-bg-white dark:nx-bg-dark nx-shadow-[0_2px_4px_rgba(0,0,0,.02),0_-1px_0_rgba(0,0,0,.06)_inset] dark:nx-shadow-[0_-1px_0_rgba(255,255,255,.1)_inset] contrast-more:nx-shadow-[0_0_0_1px_#000] contrast-more:dark:nx-shadow-[0_0_0_1px_#fff]"></div><nav class="nx-mx-auto nx-flex nx-h-[var(--nextra-navbar-height)] nx-max-w-[90rem] nx-items-center nx-justify-end nx-gap-2 nx-pl-[max(env(safe-area-inset-left),1.5rem)] nx-pr-[max(env(safe-area-inset-right),1.5rem)]"><a class="nx-flex nx-items-center hover:nx-opacity-75 ltr:nx-mr-auto rtl:nx-ml-auto" href="/reading-notes/"><img alt="Reading notes homepage" src="/reading-notes/logo.png" width="30" height="30" decoding="async" data-nimg="1" loading="lazy" style="color:transparent"/></a><div class="nextra-search nx-relative md:nx-w-64 nx-hidden md:nx-inline-block mx-min-w-[200px]"><div class="nx-relative nx-flex nx-items-center nx-text-gray-900 contrast-more:nx-text-gray-800 dark:nx-text-gray-300 contrast-more:dark:nx-text-gray-300"><input spellcheck="false" class="nx-block nx-w-full nx-appearance-none nx-rounded-lg nx-px-3 nx-py-2 nx-transition-colors nx-text-base nx-leading-tight md:nx-text-sm nx-bg-black/[.05] dark:nx-bg-gray-50/10 focus:nx-bg-white dark:focus:nx-bg-dark placeholder:nx-text-gray-500 dark:placeholder:nx-text-gray-400 contrast-more:nx-border contrast-more:nx-border-current" type="search" placeholder="Search documentation…" value=""/></div></div><a href="https://github.com/mkrtchian/reading-notes" target="_blank" rel="noreferrer" class="nx-p-2 nx-text-current"><svg width="24" height="24" fill="currentColor" viewBox="3 3 18 18"><title>GitHub</title><path d="M12 3C7.0275 3 3 7.12937 3 12.2276C3 16.3109 5.57625 19.7597 9.15374 20.9824C9.60374 21.0631 9.77249 20.7863 9.77249 20.5441C9.77249 20.3249 9.76125 19.5982 9.76125 18.8254C7.5 19.2522 6.915 18.2602 6.735 17.7412C6.63375 17.4759 6.19499 16.6569 5.8125 16.4378C5.4975 16.2647 5.0475 15.838 5.80124 15.8264C6.51 15.8149 7.01625 16.4954 7.18499 16.7723C7.99499 18.1679 9.28875 17.7758 9.80625 17.5335C9.885 16.9337 10.1212 16.53 10.38 16.2993C8.3775 16.0687 6.285 15.2728 6.285 11.7432C6.285 10.7397 6.63375 9.9092 7.20749 9.26326C7.1175 9.03257 6.8025 8.08674 7.2975 6.81794C7.2975 6.81794 8.05125 6.57571 9.77249 7.76377C10.4925 7.55615 11.2575 7.45234 12.0225 7.45234C12.7875 7.45234 13.5525 7.55615 14.2725 7.76377C15.9937 6.56418 16.7475 6.81794 16.7475 6.81794C17.2424 8.08674 16.9275 9.03257 16.8375 9.26326C17.4113 9.9092 17.76 10.7281 17.76 11.7432C17.76 15.2843 15.6563 16.0687 13.6537 16.2993C13.98 16.5877 14.2613 17.1414 14.2613 18.0065C14.2613 19.2407 14.25 20.2326 14.25 20.5441C14.25 20.7863 14.4188 21.0746 14.8688 20.9824C16.6554 20.364 18.2079 19.1866 19.3078 17.6162C20.4077 16.0457 20.9995 14.1611 21 12.2276C21 7.12937 16.9725 3 12 3Z"></path></svg><span class="nx-sr-only">GitHub</span><span class="nx-sr-only"> (opens in a new tab)</span></a><button type="button" aria-label="Menu" class="nextra-hamburger -nx-mr-2 nx-rounded nx-p-2 active:nx-bg-gray-400/20 md:nx-hidden"><svg fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor" class=""><g><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16"></path></g><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12h16"></path><g><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 18h16"></path></g></svg></button></nav></div><div class="nx-mx-auto nx-flex nx-max-w-[90rem]"><div class="motion-reduce:nx-transition-none [transition:background-color_1.5s_ease] nx-bg-transparent"></div><aside class="nextra-sidebar-container nx-flex nx-flex-col md:nx-top-16 md:nx-w-64 md:nx-shrink-0 md:nx-transform-none md:nx-sticky md:nx-self-start [transform:translate3d(0,-100%,0)]"><div class="nx-px-4 nx-pt-4 md:nx-hidden"><div class="nextra-search nx-relative md:nx-w-64"><div class="nx-relative nx-flex nx-items-center nx-text-gray-900 contrast-more:nx-text-gray-800 dark:nx-text-gray-300 contrast-more:dark:nx-text-gray-300"><input spellcheck="false" class="nx-block nx-w-full nx-appearance-none nx-rounded-lg nx-px-3 nx-py-2 nx-transition-colors nx-text-base nx-leading-tight md:nx-text-sm nx-bg-black/[.05] dark:nx-bg-gray-50/10 focus:nx-bg-white dark:focus:nx-bg-dark placeholder:nx-text-gray-500 dark:placeholder:nx-text-gray-400 contrast-more:nx-border contrast-more:nx-border-current" type="search" placeholder="Search documentation…" value=""/></div></div></div><div class="nextra-scrollbar nx-overflow-y-auto nx-p-4 nx-grow md:nx-h-[calc(100vh-var(--nextra-navbar-height)-3.75rem)]"><ul class="nx-flex nx-flex-col nx-gap-1 nx-hidden md:nx-flex"><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-500 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/reading-notes/">Introduction</a></li><li class="open"><a class="nx-items-center nx-justify-between nx-gap-2 nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-500 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50">Reading notes<svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="nx-h-[18px] nx-min-w-[18px] nx-rounded-sm nx-p-0.5 hover:nx-bg-gray-800/5 dark:hover:nx-bg-gray-100/5"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" class="nx-origin-center nx-transition-transform rtl:-nx-rotate-180 ltr:nx-rotate-90 rtl:nx-rotate-[-270deg]"></path></svg></a><div class="nx-transform-gpu nx-overflow-hidden nx-transition-all nx-duration-300 nx-ease-in-out motion-reduce:nx-transition-none"><div class="nx-transform-gpu nx-overflow-hidden nx-p-2 nx-transition-opacity nx-duration-500 nx-ease-in-out motion-reduce:nx-transition-none ltr:nx-pr-0 rtl:nx-pl-0" style="opacity:1"><ul class="nx-flex nx-flex-col nx-gap-1 nx-relative before:nx-absolute before:nx-inset-y-1.5 before:nx-w-px before:nx-bg-gray-200 before:nx-content-[&quot;&quot;] dark:before:nx-bg-neutral-800 ltr:nx-pl-3 ltr:before:nx-left-0 rtl:nx-pr-3 rtl:before:nx-right-0 ltr:nx-ml-1 rtl:nx-mr-1"><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-500 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/reading-notes/books/designing-data-intensive-applications/">Designing Data-Intensive Applications</a></li><li class="nx-flex nx-flex-col nx-gap-1 active"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-bg-primary-50 nx-font-bold nx-text-primary-600 dark:nx-bg-primary-500/10 contrast-more:nx-border-primary-500 contrast-more:dark:nx-border-primary-500" href="/reading-notes/books/get-your-hands-dirty-on-clean-architecture/">Get Your Hands Dirty on Clean Architecture</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-500 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/reading-notes/books/the-design-of-web-apis/">The Design of Web APIs</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-500 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/reading-notes/books/unit-testing/">Unit Testing: Principles, Practices, and Patterns</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-500 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/reading-notes/books/learning-domain-driven-design/">Learning Domain-Driven Design</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-500 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/reading-notes/books/continuous-discovery-habits/">Continuous Discovery Habits</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-500 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/reading-notes/books/refactoring/">Refactoring: Improving the Design of Existing Code</a></li></ul></div></div></li></ul><ul class="nx-flex nx-flex-col nx-gap-1 md:nx-hidden"><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-500 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/reading-notes/">Introduction</a></li><li class="open"><a class="nx-items-center nx-justify-between nx-gap-2 nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-500 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50">Reading notes<svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="nx-h-[18px] nx-min-w-[18px] nx-rounded-sm nx-p-0.5 hover:nx-bg-gray-800/5 dark:hover:nx-bg-gray-100/5"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" class="nx-origin-center nx-transition-transform rtl:-nx-rotate-180 ltr:nx-rotate-90 rtl:nx-rotate-[-270deg]"></path></svg></a><div class="nx-transform-gpu nx-overflow-hidden nx-transition-all nx-duration-300 nx-ease-in-out motion-reduce:nx-transition-none"><div class="nx-transform-gpu nx-overflow-hidden nx-p-2 nx-transition-opacity nx-duration-500 nx-ease-in-out motion-reduce:nx-transition-none ltr:nx-pr-0 rtl:nx-pl-0" style="opacity:1"><ul class="nx-flex nx-flex-col nx-gap-1 nx-relative before:nx-absolute before:nx-inset-y-1.5 before:nx-w-px before:nx-bg-gray-200 before:nx-content-[&quot;&quot;] dark:before:nx-bg-neutral-800 ltr:nx-pl-3 ltr:before:nx-left-0 rtl:nx-pr-3 rtl:before:nx-right-0 ltr:nx-ml-1 rtl:nx-mr-1"><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-500 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/reading-notes/books/designing-data-intensive-applications/">Designing Data-Intensive Applications</a></li><li class="nx-flex nx-flex-col nx-gap-1 active"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-bg-primary-50 nx-font-bold nx-text-primary-600 dark:nx-bg-primary-500/10 contrast-more:nx-border-primary-500 contrast-more:dark:nx-border-primary-500" href="/reading-notes/books/get-your-hands-dirty-on-clean-architecture/">Get Your Hands Dirty on Clean Architecture</a><ul class="nx-flex nx-flex-col nx-gap-1 nx-relative before:nx-absolute before:nx-inset-y-1.5 before:nx-w-px before:nx-bg-gray-200 before:nx-content-[&quot;&quot;] dark:before:nx-bg-neutral-800 ltr:nx-pl-3 ltr:before:nx-left-0 rtl:nx-pr-3 rtl:before:nx-right-0 ltr:nx-ml-3 rtl:nx-mr-3"><li><a href="#1---whats-wrong-with-layers" class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-flex nx-gap-2 before:nx-opacity-25 before:nx-content-[&quot;#&quot;] nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-500 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50">1 - What’s Wrong With Layers?</a></li><li><a href="#2---inverting-dependencies" class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-flex nx-gap-2 before:nx-opacity-25 before:nx-content-[&quot;#&quot;] nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-500 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50">2 - Inverting dependencies</a></li><li><a href="#3---organizing-code" class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-flex nx-gap-2 before:nx-opacity-25 before:nx-content-[&quot;#&quot;] nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-500 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50">3 - Organizing Code</a></li><li><a href="#4---implementing-a-use-case" class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-flex nx-gap-2 before:nx-opacity-25 before:nx-content-[&quot;#&quot;] nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-500 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50">4 - Implementing a Use Case</a></li><li><a href="#5---implementing-a-web-adapter" class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-flex nx-gap-2 before:nx-opacity-25 before:nx-content-[&quot;#&quot;] nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-500 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50">5 - Implementing a Web Adapter</a></li><li><a href="#6---implementing-a-persistence-adapter" class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-flex nx-gap-2 before:nx-opacity-25 before:nx-content-[&quot;#&quot;] nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-500 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50">6 - Implementing a Persistence Adapter</a></li><li><a href="#7---testing-architecture-elements" class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-flex nx-gap-2 before:nx-opacity-25 before:nx-content-[&quot;#&quot;] nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-500 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50">7 - Testing Architecture Elements</a></li><li><a href="#8-mapping-between-boundaries" class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-flex nx-gap-2 before:nx-opacity-25 before:nx-content-[&quot;#&quot;] nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-500 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50">8. Mapping Between Boundaries</a></li><li><a href="#9---assembling-the-application" class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-flex nx-gap-2 before:nx-opacity-25 before:nx-content-[&quot;#&quot;] nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-500 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50">9 - Assembling the Application</a></li><li><a href="#10---enforcing-architecture-boundaries" class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-flex nx-gap-2 before:nx-opacity-25 before:nx-content-[&quot;#&quot;] nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-500 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50">10 - Enforcing Architecture Boundaries</a></li><li><a href="#11---taking-shortcuts-consciously" class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-flex nx-gap-2 before:nx-opacity-25 before:nx-content-[&quot;#&quot;] nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-500 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50">11 - Taking Shortcuts Consciously</a></li><li><a href="#12---deciding-on-an-architecture-style" class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-flex nx-gap-2 before:nx-opacity-25 before:nx-content-[&quot;#&quot;] nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-500 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50">12 - Deciding on an Architecture Style</a></li></ul></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-500 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/reading-notes/books/the-design-of-web-apis/">The Design of Web APIs</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-500 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/reading-notes/books/unit-testing/">Unit Testing: Principles, Practices, and Patterns</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-500 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/reading-notes/books/learning-domain-driven-design/">Learning Domain-Driven Design</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-500 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/reading-notes/books/continuous-discovery-habits/">Continuous Discovery Habits</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-500 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/reading-notes/books/refactoring/">Refactoring: Improving the Design of Existing Code</a></li></ul></div></div></li></ul></div><div class="nx-relative nx-z-[1] nx-mx-4 nx-border-t nx-py-4 nx-shadow-[0_-12px_16px_#fff] nx-flex nx-items-center nx-gap-2 dark:nx-border-neutral-800 dark:nx-shadow-[0_-12px_16px_#111] contrast-more:nx-border-neutral-400 contrast-more:nx-shadow-none contrast-more:dark:nx-shadow-none"><div class="nx-relative"><button title="Change theme" class="nx-h-7 nx-rounded-md nx-px-2 nx-text-left nx-text-xs nx-font-medium nx-text-gray-600 nx-transition-colors dark:nx-text-gray-400 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50" id="headlessui-listbox-button-:Rlsr6:" type="button" aria-haspopup="true" aria-expanded="false" data-headlessui-state=""><div class="nx-flex nx-items-center nx-gap-2 nx-capitalize"><svg fill="none" viewBox="3 3 18 18" width="12" height="12" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" fill="currentColor" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg><span class="">light</span></div></button></div></div></aside><nav class="nextra-toc nx-order-last nx-hidden nx-w-64 nx-shrink-0 xl:nx-block nx-px-4" aria-label="table of contents"><div class="nextra-scrollbar nx-sticky nx-top-16 nx-overflow-y-auto nx-pr-4 nx-pt-8 nx-text-sm [hyphens:auto] nx-max-h-[calc(100vh-var(--nextra-navbar-height)-env(safe-area-inset-bottom))] ltr:-nx-mr-4 rtl:-nx-ml-4"><p class="nx-mb-4 nx-font-semibold nx-tracking-tight">On This Page</p><ul><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#1---whats-wrong-with-layers" class="nx-font-semibold nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50">1 - What’s Wrong With Layers?</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#2---inverting-dependencies" class="nx-font-semibold nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50">2 - Inverting dependencies</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#3---organizing-code" class="nx-font-semibold nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50">3 - Organizing Code</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#4---implementing-a-use-case" class="nx-font-semibold nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50">4 - Implementing a Use Case</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#5---implementing-a-web-adapter" class="nx-font-semibold nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50">5 - Implementing a Web Adapter</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#6---implementing-a-persistence-adapter" class="nx-font-semibold nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50">6 - Implementing a Persistence Adapter</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#7---testing-architecture-elements" class="nx-font-semibold nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50">7 - Testing Architecture Elements</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#8-mapping-between-boundaries" class="nx-font-semibold nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50">8. Mapping Between Boundaries</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#9---assembling-the-application" class="nx-font-semibold nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50">9 - Assembling the Application</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#10---enforcing-architecture-boundaries" class="nx-font-semibold nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50">10 - Enforcing Architecture Boundaries</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#11---taking-shortcuts-consciously" class="nx-font-semibold nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50">11 - Taking Shortcuts Consciously</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#12---deciding-on-an-architecture-style" class="nx-font-semibold nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50">12 - Deciding on an Architecture Style</a></li></ul><div class="nx-mt-8 nx-border-t nx-bg-white nx-pt-8 nx-shadow-[0_-12px_16px_white] dark:nx-bg-dark dark:nx-shadow-[0_-12px_16px_#111] nx-sticky nx-bottom-0 nx-flex nx-flex-col nx-items-start nx-gap-2 nx-pb-8 dark:nx-border-neutral-800 contrast-more:nx-border-t contrast-more:nx-border-neutral-400 contrast-more:nx-shadow-none contrast-more:dark:nx-border-neutral-400"><a href="https://github.com/mkrtchian/reading-notes/issues/new?title=Feedback%20for%20%E2%80%9CGet%20Your%20Hands%20Dirty%20on%20Clean%20Architecture%E2%80%9D&amp;labels=feedback" target="_blank" rel="noreferrer" class="nx-text-xs nx-font-medium nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-100 contrast-more:nx-text-gray-800 contrast-more:dark:nx-text-gray-50">Question? Give me feedback →<span class="nx-sr-only"> (opens in a new tab)</span></a><a class="nx-text-xs nx-font-medium nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-100 contrast-more:nx-text-gray-800 contrast-more:dark:nx-text-gray-50" href="https://github.com/mkrtchian/reading-notes/blob/main/pages/books/get-your-hands-dirty-on-clean-architecture.md">Edit this page</a></div></div></nav><div id="reach-skip-nav" data-reach-skip-nav-content=""></div><article class="nx-flex nx-min-h-[calc(100vh-4rem)] nx-w-full nx-min-w-0 nx-max-w-full nx-justify-center nx-pb-8 nx-pr-[calc(env(safe-area-inset-right)-1.5rem)]"><main class="nx-w-full nx-min-w-0 nx-max-w-4xl nx-px-6 nx-pt-4 md:nx-px-8"><div class="nextra-breadcrumb nx-mt-2.5 nx-flex nx-items-center nx-gap-1 nx-overflow-hidden nx-text-sm nx-text-gray-500 contrast-more:nx-text-current"><div class="nx-whitespace-nowrap nx-transition-colors nx-min-w-[24px] nx-overflow-hidden nx-text-ellipsis" title="Reading notes">Reading notes</div><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="nx-w-3.5 nx-shrink-0"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg><div class="nx-whitespace-nowrap nx-transition-colors nx-font-medium nx-text-gray-700 contrast-more:nx-font-bold contrast-more:nx-text-current dark:nx-text-gray-400 contrast-more:dark:nx-text-current" title="Get Your Hands Dirty on Clean Architecture">Get Your Hands Dirty on Clean Architecture</div></div><h1 class="nx-mt-2 nx-text-4xl nx-font-bold nx-tracking-tight">Get Your Hands Dirty on Clean Architecture</h1>
<h2 class="nx-font-semibold nx-tracking-tight nx-mt-10 nx-border-b nx-pb-1 nx-text-3xl contrast-more:nx-border-neutral-400 dark:nx-border-primary-100/10 contrast-more:dark:nx-border-neutral-400">1 - What’s Wrong With Layers?<span class="nx-absolute -nx-mt-20" id="1---whats-wrong-with-layers"></span><a href="#1---whats-wrong-with-layers" class="subheading-anchor" aria-label="Permalink for this section"></a></h2>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">La <strong>layered architecture</strong> est tout à fait classique : 3 couches successives (web -&gt; domain -&gt; persistance).<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Elle peut même permettre une bonne architecture qui laisse les options ouvertes (par exemple remplacer la persistance en ne touchant que cette couche-là).</li>
</ul>
</li>
<li class="nx-my-2">Le problème de la layered architecture c’est qu’<strong>elle se détériore rapidement et encourage les mauvaises habitudes.</strong>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Elle promeut le <strong>database-driven design</strong> : vu que la persistance est à la base, on part toujours depuis la modélisation de la structure de la DB.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Au lieu de ça on devrait mettre au centre le comportement, c’est-à-dire le code métier, et considérer la persistance comme périphérique.</li>
<li class="nx-my-2">Un des éléments qui pousse au database-driven design aussi c’est l’ORM, qui peut être utilisé depuis le layer domain, et introduit des considérations techniques dedans.</li>
</ul>
</li>
<li class="nx-my-2">Elle encourage les <strong>raccourcis</strong> : quand un layer du dessus a besoin d’un élément du dessous, il suffit de le pousser vers le bas et il y aura accès.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">La couche de persistance finit par grossir et devenir une énorme couche “utilitaire” qui contient la logique et les aspects techniques entremêlés.</li>
</ul>
</li>
<li class="nx-my-2">Elle devient de plus en plus <strong>difficile à tester</strong> :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Le logique métier a tendance à fuiter vers la couche web, parce que la persistance y est directement utilisée.</li>
<li class="nx-my-2">Tester la couche web devient de plus en plus difficile parce qu’il faut mocker les deux autres, et parce que la logique y grossit.</li>
</ul>
</li>
<li class="nx-my-2">Elle <strong>cache les use cases</strong> : la logique fuitant vers les autres layers, on ne sait pas où ajouter un nouveau use-case, ni où chercher un existant.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On peut ajouter à ça que vu qu’il n’y a pas de limite, la couche domain a des unités (services) qui grossissent au fil du temps, ce qui rend plus difficile de trouver où va chaque fonctionnalité.</li>
</ul>
</li>
<li class="nx-my-2">Elle rend le <strong>travail en parallèle</strong> difficile :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Comme on fait du database-driven design, on doit toujours commencer par la couche de persistance, et on ne peut pas être plusieurs à la toucher.</li>
<li class="nx-my-2">Si en plus les services du domaine sont gros, on peut être en difficulté pour être plusieurs à modifier un gros service pour plusieurs raisons.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 class="nx-font-semibold nx-tracking-tight nx-mt-10 nx-border-b nx-pb-1 nx-text-3xl contrast-more:nx-border-neutral-400 dark:nx-border-primary-100/10 contrast-more:dark:nx-border-neutral-400">2 - Inverting dependencies<span class="nx-absolute -nx-mt-20" id="2---inverting-dependencies"></span><a href="#2---inverting-dependencies" class="subheading-anchor" aria-label="Permalink for this section"></a></h2>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Le <strong>Single Responsibility Principle</strong> (SRP) dit qu’un composant doit avoir une seule <strong>raison de changer</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Ça veut dire que si on change le logiciel pour n’importe quelle autre raison, il ne devrait pas changer.</li>
<li class="nx-my-2">Quand nos composants dépendent les uns des autres, ça leur donne autant de raisons à chaque fois de changer, si un des composants dont ils dépendent change lui aussi.</li>
</ul>
</li>
<li class="nx-my-2">La layered architecture fait que la couche web et la couche domain ont des raisons de changer liées à la couche de persistance. On n’a pas envie que la couche domain change pour d’autres raisons qu’elle-même, donc on va <strong>inverser les dépendances</strong> qu’elle a.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">C’est le Dependency Inversion Principle (DIP).</li>
<li class="nx-my-2">On va copier les entities depuis la persistance vers la couche domain qui en a besoin aussi.</li>
<li class="nx-my-2">Et on va créer une interface de persistance dans le domaine, à laquelle va adhérer la couche persistance qui aura donc une dépendance vers le domaine plutôt que l’inverse.</li>
</ul>
</li>
<li class="nx-my-2">Selon Robert Martin la <strong>clean architecture</strong> doit garder le domaine séparé du reste (frameworks, infrastructure etc.), et les dépendances doivent être tournées vers le code du domaine pour que celui-ci n’en ait pas d’autres que lui-même.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Les <strong>entities</strong> du domaine sont au centre.</li>
<li class="nx-my-2">Ils sont utilisés par les <strong>use cases</strong>, qui représentent les services, mais impliquent d’avoir une granularité fine.</li>
<li class="nx-my-2">Cette séparation a un coût, qui est qu’il faut <strong>dupliquer les entités</strong> entre le domaine et l’infrastructure, notamment pour éviter que les entités du domaine soient polluées par la technique.</li>
</ul>
</li>
<li class="nx-my-2">L’<strong>hexagonal architecture</strong> est similaire à la clean architecture mais un peu moins “abstraite”, c’est la version d’Alistair Cockburn.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">L’hexagone contient les entities et les use cases, et en dehors on trouve des adapters pour intégrer la communication avec l’extérieur.</li>
<li class="nx-my-2">On a deux types d’<strong>adapters</strong> :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Les adapteurs de gauche drivent l’hexagone, parce qu’ils appellent des fonctions exposées par l’hexagone.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Exemple : handlers HTTP.</li>
</ul>
</li>
<li class="nx-my-2">Les adapters de droite sont drivées par l’hexagone, parce que l’hexagone appelle des méthodes sur eux.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Exemple : communication avec la DB.</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2">Pour permettre la communication, l’hexagone définit des ports (interfaces), qui doivent être implémentés par les adapters.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">C’est pour ça qu’on parle de Ports &amp; Adapters.</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2">Quel que soit leur nom, tout l’intérêt de ces architectures c’est de permettre d’avoir un <strong>domaine isolé</strong>, dont on pourra gérer la complexité sans qu’il ait d’autres raisons de changer que lui-même.</li>
</ul>
<h2 class="nx-font-semibold nx-tracking-tight nx-mt-10 nx-border-b nx-pb-1 nx-text-3xl contrast-more:nx-border-neutral-400 dark:nx-border-primary-100/10 contrast-more:dark:nx-border-neutral-400">3 - Organizing Code<span class="nx-absolute -nx-mt-20" id="3---organizing-code"></span><a href="#3---organizing-code" class="subheading-anchor" aria-label="Permalink for this section"></a></h2>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On peut organiser le code <strong>par couches</strong> : le classique web, domain et persistance, mais avec une inversion de la persistance vers le domain.<!-- -->
<div data-rehype-pretty-code-fragment=""><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-font-medium nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4 "><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10  " dir="ltr" data-language="yaml" data-theme="default"><span class="line"><span style="color:var(--shiki-color-text)">- </span><span style="color:var(--shiki-token-string-expression)">web</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">- </span><span style="color:var(--shiki-token-string-expression)">AccountController</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">- </span><span style="color:var(--shiki-token-string-expression)">domain</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">- </span><span style="color:var(--shiki-token-string-expression)">Account</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">- </span><span style="color:var(--shiki-token-string-expression)">AccountService</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">- </span><span style="color:var(--shiki-token-string-expression)">AccountRepositoryPort</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">- </span><span style="color:var(--shiki-token-string-expression)">persistance</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">- </span><span style="color:var(--shiki-token-string-expression)">AccountRepositoryImpl</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button></div></div>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Mais cette organisation est sous-optimale pour 3 raisons :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Il n’y a pas de séparation sous forme de dossiers ou de packages pour les fonctionnalités. Donc elles vont vite s’entre-mêler au sein de chaque couche.</li>
<li class="nx-my-2">Comme les services sont gros, on peut difficilement repérer la fonctionnalité exacte qu’on cherche tout de suite.</li>
<li class="nx-my-2">On ne voit pas au premier coup d&#x27;œil quelle partie de la persistance implémente quel port côté domain. L’architecture ne saute pas aux yeux.</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2">On peut ensuite organiser le code <strong>par features</strong> : les limites de dossier/package sont définies par les features qui contiennent un fichier par couche.<!-- -->
<div data-rehype-pretty-code-fragment=""><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-font-medium nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4 "><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10  " dir="ltr" data-language="yaml" data-theme="default"><span class="line"><span style="color:var(--shiki-color-text)">- </span><span style="color:var(--shiki-token-string-expression)">account</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">- </span><span style="color:var(--shiki-token-string-expression)">Account</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">- </span><span style="color:var(--shiki-token-string-expression)">AccountController</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">- </span><span style="color:var(--shiki-token-string-expression)">AccountRepository</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">- </span><span style="color:var(--shiki-token-string-expression)">AccountRepositoryImpl</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">- </span><span style="color:var(--shiki-token-string-expression)">SendMoneyService</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button></div></div>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On a nos features visibles immédiatement (<code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10  " dir="ltr">Account -&gt; SendMoneyService</code>), ce qui fait qu’on est dans le cadre d’une <strong>screaming architecture</strong>.</li>
<li class="nx-my-2">Par contre, nos couches techniques sont très peu protégées, et le code du domaine n’est plus protégé du reste par des séparations fortes.</li>
</ul>
</li>
<li class="nx-my-2">On peut enfin organiser le code dans une architecture <strong>expressive</strong>, reprenant le meilleur des deux autres :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Une séparation initiale par features majeures.</li>
<li class="nx-my-2">Puis une séparation par couches à l’intérieur de ces features majeures.</li>
<li class="nx-my-2">Et enfin la séparation explicite des ports et adapters, en explicitant leur nature entrante ou sortante.<!-- -->
<div data-rehype-pretty-code-fragment=""><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-font-medium nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4 "><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10  " dir="ltr" data-language="yaml" data-theme="default"><span class="line"><span style="color:var(--shiki-color-text)">- </span><span style="color:var(--shiki-token-string-expression)">account</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">- </span><span style="color:var(--shiki-token-string-expression)">adapter</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  - </span><span style="color:var(--shiki-token-string-expression)">in</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  - </span><span style="color:var(--shiki-token-string-expression)">web</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  - </span><span style="color:var(--shiki-token-string-expression)">AccountController</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  - </span><span style="color:var(--shiki-token-string-expression)">out</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  - </span><span style="color:var(--shiki-token-string-expression)">persistance</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  - </span><span style="color:var(--shiki-token-string-expression)">AccountPersistanceAdapter</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">- </span><span style="color:var(--shiki-token-string-expression)">domain</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  - </span><span style="color:var(--shiki-token-string-expression)">Account</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">- </span><span style="color:var(--shiki-token-string-expression)">application</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  - </span><span style="color:var(--shiki-token-string-expression)">SendMoneyService</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  - </span><span style="color:var(--shiki-token-string-expression)">port</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  - </span><span style="color:var(--shiki-token-string-expression)">in</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  - </span><span style="color:var(--shiki-token-string-expression)">SendMoneyUseCase</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  - </span><span style="color:var(--shiki-token-string-expression)">out</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  - </span><span style="color:var(--shiki-token-string-expression)">LoadAccountPort</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  - </span><span style="color:var(--shiki-token-string-expression)">UpdateAccountStatePort</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button></div></div>
</li>
<li class="nx-my-2">Le fait que l’architecture soit alignée avec la structure en packages fait que nous avons moins de chances d’en dévier. Elle est incarnée de manière très concrète dans le code.</li>
<li class="nx-my-2">Le domaine étant isolé, on peut très bien en faire ce qu’on veut, y compris y appliquer les patterns tactiques du DDD.</li>
<li class="nx-my-2">Côté visibilité des packages :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Les adapters peuvent rester privés, puisqu’ils ne sont appelés qu’à travers les ports.</li>
<li class="nx-my-2">Les ports doivent être publics pour être accessibles par les adapters.</li>
<li class="nx-my-2">Les objets du domaine doivent être publics pour être accessibles depuis les services et les adapters.</li>
<li class="nx-my-2">Les services peuvent rester privés parce qu’ils sont appelés à travers les ports primaires.</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2">Concernant la manière dont fonctionne l’<strong>inversion de dépendance</strong> ici :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Pour les adpaters entrants il n’y a pas besoin d’inversion puisqu’ils sont déjà entrants vers l’hexagone. On peut, au besoin, quand même protéger l’hexagone derrière des ports quand même.</li>
<li class="nx-my-2">Pour les adapters sortants par contre il faut inverser la dépendance, en les faisant respecter le port de l’hexagone, puis en les instanciant et les donnant à l’hexagone.</li>
<li class="nx-my-2">Il faut donc un <strong>composant tiers neutre</strong> qui instancie les adapters sortants pour les donner à l’hexagone, et instancie l’hexagone pour le donner aux adapters entrants.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Il s’agit de l’<strong>injection de dépendance</strong>.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 class="nx-font-semibold nx-tracking-tight nx-mt-10 nx-border-b nx-pb-1 nx-text-3xl contrast-more:nx-border-neutral-400 dark:nx-border-primary-100/10 contrast-more:dark:nx-border-neutral-400">4 - Implementing a Use Case<span class="nx-absolute -nx-mt-20" id="4---implementing-a-use-case"></span><a href="#4---implementing-a-use-case" class="subheading-anchor" aria-label="Permalink for this section"></a></h2>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Comme on a une forte séparation hexagone/adapters, on peut implémenter l’hexagone de la manière dont on veut, y compris avec les patterns tactiques du DDD, mais pas forcément.</li>
<li class="nx-my-2">Dans ce chapitre on implémente un use-case dans l’hexagone de l’exemple <em>buckpal</em> qui est une application de gestion de paiement.</li>
<li class="nx-my-2">La <strong>couche domain</strong> se trouve dans <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10  " dir="ltr">buckpal -&gt; domain</code>, et contient une entité <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10  " dir="ltr">Account</code>, qui a des méthodes pour ajouter et retirer de l’argent.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Chaque ajout ou retrait se fait en empilant des entités <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10  " dir="ltr">Activity</code> qui contiennent chaque transaction dans un tableau interne à <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10  " dir="ltr">Account</code>.</li>
<li class="nx-my-2">Le tableau interne ne contient qu’une fenêtre d’<code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10  " dir="ltr">Activity</code> pour des raisons de performance, et une variable permet de connaître la valeur du compte avant ce nombre restreint d’<code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10  " dir="ltr">Activity</code>.</li>
</ul>
</li>
<li class="nx-my-2">Les use-cases se trouvent dans la <strong>couche applicative</strong>, dans <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10  " dir="ltr">buckpal -&gt; application -&gt; service</code>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Un use-case va :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Récupérer l’input (qu’il ne valide pas par lui-même pour laisser cette responsabilité à un autre composant).</li>
<li class="nx-my-2">Valider les règles business, dont la responsabilité est partagée avec la couche domain.</li>
<li class="nx-my-2">Manipuler l’état du domaine :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Ça se fait en instanciant des entités et appelant des méthodes sur elles.</li>
<li class="nx-my-2">Et en général en passant les entités à un adapter pour que leur état soit persisté.</li>
<li class="nx-my-2">Appeler éventuellement d’autres use-cases.</li>
</ul>
</li>
<li class="nx-my-2">Retourner l’output.</li>
</ul>
</li>
<li class="nx-my-2">Les use-cases vont être petits pour éviter le problème de gros services où on ne sait pas quelle fonctionnalité va où.</li>
</ul>
</li>
<li class="nx-my-2">La <strong>validation des inputs</strong> se fait dans la couche applicative pour permettre d’appeler l’hexagone depuis plusieurs controllers sans qu’ils aient à valider ces données, et pour garantir l’intégrité des données dans l’hexagone.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On va faire la validation dans une classe de type <strong>command</strong>. Cette classe valide les données dans son constructeur, et refuse d’être instanciée si les données sont invalides.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">L’auteur déconseille d’utiliser le pattern builder et conseille d’appeler directement le constructeur.</li>
<li class="nx-my-2">Exemple de builder :<!-- -->
<div data-rehype-pretty-code-fragment=""><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-font-medium nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4 "><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10  " dir="ltr" data-language="typescript" data-theme="default"><span class="line"><span style="color:var(--shiki-token-keyword)">new</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">CommandBuilder</span><span style="color:var(--shiki-color-text)">()</span><span style="color:var(--shiki-token-function)">.setParameterA</span><span style="color:var(--shiki-color-text)">(value1)</span><span style="color:var(--shiki-token-function)">.setParameterB</span><span style="color:var(--shiki-color-text)">(value2)</span><span style="color:var(--shiki-token-function)">.build</span><span style="color:var(--shiki-color-text)">();</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button></div></div>
</li>
</ul>
</li>
<li class="nx-my-2">Cette classe va se trouver dans <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10  " dir="ltr">buckpal -&gt; application -&gt; port -&gt; in</code>.</li>
<li class="nx-my-2">Elle constitue une sorte d’anti-corruption layer protégeant l’hexagone.</li>
</ul>
</li>
<li class="nx-my-2">On pourrait être tenté de <strong>réutiliser des classes de validation d’input</strong> entre plusieurs use-cases ressemblants, par exemple la création d’un compte et la modification d’un compte. L’auteur <strong>le déconseille</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Si on réutilise, on va se retrouver avec quelques différences (par exemple l’ID du compte) qui vont introduire de potentielles mauvaises données.</li>
<li class="nx-my-2">On va se retrouver à gérer les différences entre les deux modèles dans les use-cases alors qu’on voulait le faire dans un objet à part.</li>
<li class="nx-my-2">Globalement, faire des modèles de validation d’input permet, au même titre que le fait de faire des petits use-cases, de garder l’architecture maintenable dans le temps.</li>
</ul>
</li>
<li class="nx-my-2">La <strong>validation des business rules</strong> doit quant à elle être faite dans les use-cases.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">La différence avec la validation des inputs c’est que pour les inputs il n’y a pas besoin d’<strong>accéder à l’état du modèle de données</strong>, alors que pour les business rules oui.</li>
<li class="nx-my-2">Le use-case peut le faire directement en appelant des fonctions, ou alors le déléguer à des entities.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Dans le cas où l&#x27;essentiel de la logique est fait dans les entities et où le use-case orchestre juste des appels et passe les données, on parle d’un <strong>rich domain model</strong>. Dans le cas où c’est le use-case qui a l’essentiel de la logique et les entities sont maigres, on parlera d’un <strong>anemic domain model</strong>.</li>
</ul>
</li>
<li class="nx-my-2">Le use-case lève une exception en cas de non-respect des règles business comme pour les règles d’input. Ce sera à l’adapter entrant de décider de ce qu’il fait de ces exceptions.</li>
</ul>
</li>
<li class="nx-my-2">Concernant <strong>l’output</strong> renvoyé par le use-case, il faut qu’il soit <strong>le plus minimal possible</strong> : n’inclure que ce dont l’appelant a besoin.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Si on retourne beaucoup de choses, on risque de voir des use-cases couplés entre eux via l’output (quand on ajoute un champ à l’objet retourné, on a besoin de changer tous ceux qui le retournent).</li>
</ul>
</li>
<li class="nx-my-2">Les use-cases qui font <strong>uniquement de la lecture</strong> pour renvoyer de la donnée peuvent être distinguées des use-cases qui écrivent.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Pour ça on peut les faire implémenter un autre port entrant que les use-cases d’écriture, par exemple le port <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10  " dir="ltr">GetAccountBalanceQuery</code>.</li>
<li class="nx-my-2">On pourra à partir de là faire du CQS ou du CQRS.</li>
</ul>
</li>
</ul>
<h2 class="nx-font-semibold nx-tracking-tight nx-mt-10 nx-border-b nx-pb-1 nx-text-3xl contrast-more:nx-border-neutral-400 dark:nx-border-primary-100/10 contrast-more:dark:nx-border-neutral-400">5 - Implementing a Web Adapter<span class="nx-absolute -nx-mt-20" id="5---implementing-a-web-adapter"></span><a href="#5---implementing-a-web-adapter" class="subheading-anchor" aria-label="Permalink for this section"></a></h2>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Tous les appels extérieurs passent par des <strong>adapters entrants</strong>.</li>
<li class="nx-my-2">Comme le flow d’appel est déjà dirigé de l’adapter vers l’hexagone, on pourrait enlever le port, et laisser l’adapter appeler directement les use-cases.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">La matérialisation des ports permet d’avoir un endroit où tous <strong>les points d’entrée de l’hexagone sont clairement identifiés</strong> et spécifiés. C’est utile pour la maintenance à long terme.</li>
<li class="nx-my-2">Enlever ces ports fait partie des raccourcis discutés dans le chapitre 11.</li>
<li class="nx-my-2">Dans le cas où notre adapter est un WebSocket qui va appeler mais aussi qui sera appelé, alors il faut obligatoirement avoir les ports entrants, et surtout sortants, puisque là on a bien une inversion du sens d’appel.</li>
</ul>
</li>
<li class="nx-my-2">Les adapters web vont :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Créer des objets internes à partir des objets HTTP.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On parle aussi de désérialisation.</li>
</ul>
</li>
<li class="nx-my-2">Vérifier les autorisations.</li>
<li class="nx-my-2">Valider l’input, et le faire correspondre à l’input du use-case qui va être appelé.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Vu qu’on valide déjà l’input à l’entrée du use-case, on va ici seulement valider le fait que l’input reçu peut bien être converti dans l’input du use-case.</li>
</ul>
</li>
<li class="nx-my-2">Appeler le use-case.</li>
<li class="nx-my-2">Récupérer l’output, et reconstruire un objet HTTP à partir de ça pour le renvoyer.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On parle aussi de sérialisation.</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2">L’adapter se trouve dans <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10  " dir="ltr">buckpal -&gt; adapter -&gt; in -&gt; web</code>.</li>
<li class="nx-my-2">L’adapter web a la responsabilité de communiquer avec le protocole HTTP. C’est une responsabilité qu’il doit avoir seul, et donc <strong>ne pas faire fuiter des détails du HTTP dans le use-case</strong>.</li>
<li class="nx-my-2">Concernant la taille des controllers, il vaut mieux les avoir <strong>les plus petits et précis possibles</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Il vaut mieux éviter de créer par exemple une classe <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10  " dir="ltr">AccountController</code> qui va avoir plusieurs méthodes associées chacune à un endpoint.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Ce genre de classe peut grossir et devenir difficile à maintenir. De même pour les tests associés.</li>
<li class="nx-my-2">Le fait d’être dans une classe fait que ces controllers vont partager des fonctions et objets entre eux. Et donc vont être plus facilement couplés.</li>
</ul>
</li>
<li class="nx-my-2">On peut nommer les classes de web adapter avec des noms plus précis que <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10  " dir="ltr">UpdateX</code>, <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10  " dir="ltr">CreateX</code> etc. Par exemple <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10  " dir="ltr">RegisterAccount</code>.</li>
<li class="nx-my-2">Les petits controllers permettent aussi de travailler plus facilement sur le code en parallèle.</li>
</ul>
</li>
</ul>
<h2 class="nx-font-semibold nx-tracking-tight nx-mt-10 nx-border-b nx-pb-1 nx-text-3xl contrast-more:nx-border-neutral-400 dark:nx-border-primary-100/10 contrast-more:dark:nx-border-neutral-400">6 - Implementing a Persistence Adapter<span class="nx-absolute -nx-mt-20" id="6---implementing-a-persistence-adapter"></span><a href="#6---implementing-a-persistence-adapter" class="subheading-anchor" aria-label="Permalink for this section"></a></h2>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Avec l’adapter de persistance, on a une vraie inversion des dépendances qui fait que malgré le sens des appels de l’hexagone vers l’adapter, grâce au port c’est l’adapter qui dépend de l’hexagone.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On va donc pouvoir faire des modifications dans l’adapter de persistance sans que ça n’affecte la logique business.</li>
</ul>
</li>
<li class="nx-my-2">Les adapters de persistance vont :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Prendre l’input.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Ca peut être une domain entity ou un objet spécifique pour une opération en base.</li>
</ul>
</li>
<li class="nx-my-2">Le mapper au format base de données et l’envoyer à DB.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">En général on va mapper vers les entities de l’ORM, mais ça peut aussi être vers des requêtes SQL directement.</li>
</ul>
</li>
<li class="nx-my-2">Récupérer la réponse DB et la mapper au format applicatif.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">En général une domain entity.</li>
</ul>
</li>
<li class="nx-my-2">Renvoyer la valeur à l’application service.</li>
</ul>
</li>
<li class="nx-my-2">L’adapter se trouve dans <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10  " dir="ltr">buckpal -&gt; adapter -&gt; out -&gt; persistance</code>.</li>
<li class="nx-my-2">Il faut que <strong>les modèles d’input et d’output vers et depuis le persistance adapter</strong> soient tous deux <strong>dans l’application core</strong> (hexagone).</li>
<li class="nx-my-2">Plutôt qu’avoir un gros port qui permet d’accéder à toutes les méthodes de l’adapter correspondant à une entity, il vaut mieux avoir des ports plus fins.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Une des raisons c’est qu’il est plus difficile de mocker le persistance adapter en entier que de mocker certaines de ses méthodes correspondant aux ports utilisés.</li>
<li class="nx-my-2">La plupart du temps on va se retrouver avec <strong>une méthode de l’adapter par port</strong>.</li>
</ul>
</li>
<li class="nx-my-2">Pour ce qui est de l’adapter lui-même (celui qu’on accède via les ports), on peut l’avoir gros, mais on peut aussi le découper, par exemple pour avoir un adapter par entity, ou un par aggregate (si on utilise les patterns tactiques du DDD).<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On pourrait aussi créer deux adapters pour une même entity : un pour les méthodes utilisant notre ORM, et un autre pour les méthodes utilisant du SQL directement.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Dans l’adapter on pourra donc utiliser les entities de l’ORM, ou alors des <strong>repositories</strong> faites à la main, qui contiendront des méthodes exécutant du SQL.</li>
</ul>
</li>
<li class="nx-my-2">Séparer les aggregates dans des adapters distincts permet aussi de faciliter l’extraction d’un bounded context par la suite.</li>
</ul>
</li>
<li class="nx-my-2">On va donc avoir une <strong>duplication des domain entities</strong> dans le persistance adapter, en général sous forme d’entities d’ORM.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Utiliser les entities ORM dans le domaine peut être un choix possible pour éviter des mappings (discuté dans le chapitre 8), mais ça a le désavantage de faire fuiter des contraintes spécifiques à la DB vers le domaine.</li>
</ul>
</li>
<li class="nx-my-2">L’adapter en lui-même :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Pour une lecture, il appelle des méthodes sur les entities ORM ou sur les repositories maison, puis il map le résultat à une entity domaine et la renvoie.</li>
<li class="nx-my-2">Pour une écriture, il récupère l’entity domaine, la map vers l’entity ORM ou vers la méthode de repository maison, et exécute la méthode sur celle-ci.</li>
</ul>
</li>
<li class="nx-my-2">Concernant les <strong>transactions</strong>, elles ne peuvent pas être dans l’adapter de persistance. Elles doivent être dans la fonction qui orchestre les appels à la persistance, c&#x27;est-à-dire les use-cases applicatifs.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Si on veut garder nos use-cases purs, on peut recourir à l’<strong>aspect-oriented programming</strong>, par exemple avec AspectJ.</li>
</ul>
</li>
</ul>
<h2 class="nx-font-semibold nx-tracking-tight nx-mt-10 nx-border-b nx-pb-1 nx-text-3xl contrast-more:nx-border-neutral-400 dark:nx-border-primary-100/10 contrast-more:dark:nx-border-neutral-400">7 - Testing Architecture Elements<span class="nx-absolute -nx-mt-20" id="7---testing-architecture-elements"></span><a href="#7---testing-architecture-elements" class="subheading-anchor" aria-label="Permalink for this section"></a></h2>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Il y a 3 types de tests dans la pyramide :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Plus on monte dans la pyramide, et plus les tests sont lents et fragiles, donc plus on monte et moins nombreux doivent être les tests.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Les <strong>unit tests</strong> testent en général une seule classe.</li>
<li class="nx-my-2">Les <strong>integration tests</strong> mettent en jeu le code de plusieurs couches, et vont souvent mocker certaines d’entre-elles.</li>
<li class="nx-my-2">Les <strong>system tests</strong> testent le tout de bout en bout, sans mocks (autre que les composants qu’on ne peut pas instancier dans notre test).<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On pourra parler de end-to-end tests si on teste depuis le frontend et non depuis l’API du backend.</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2">NDLR : l’auteur adopte une vision proche de l’école de Londres, en considérant qu’un test teste une unité de code (et pas une unité de comportement peu importe la quantité de code), et qu’en testant plusieurs bouts de code ensemble il faut mocker les bouts de codes voisins (c’est comme ça qu’on obtient des tests fragiles aux refactorings).</li>
</ul>
</li>
<li class="nx-my-2">Côté implémentation :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Les <strong>domain entities</strong> sont testés avec des unit tests (state-based).<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">NDLR : Dans l’exemple on teste Account, mais pour autant on ne mock pas Activity, on en construit une vraie instance. Donc sur cet exemple en tout cas, on n’est pas tout à fait dans l’école de Londre non plus.</li>
</ul>
</li>
<li class="nx-my-2">Les <strong>use-cases</strong> sont testés avec des unit tests (communication based) vérifiant que le use-case appelle la bonne méthode sur le domain entity et sur l’adapter de persistance.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">NDLR : Là on est bien dans la London school.</li>
<li class="nx-my-2">L’auteur fait remarquer que le test utilisant des mocks, il est couplé à la structure du code et pas seulement au comportement. Et donc il conseille de ne pas forcément tout tester, pour éviter que ces tests cassent trop souvent.</li>
</ul>
</li>
<li class="nx-my-2">Les <strong>web adapters</strong> sont testés avec des tests d’intégration.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On parle ici d’intégration parce qu’on est “intégré” avec autre chose que du code pur, en l’occurrence avec la librairie de communication HTTP.</li>
<li class="nx-my-2">Il s’agit de tests communication based, envoyant un faux message HTTP sur le bon path, et vérifiant qu’on a fait un appel sur le bon use-case mocké, avec la bonne commande.</li>
</ul>
</li>
<li class="nx-my-2">Les <strong>persistance adapters</strong> sont testés avec des tests d’intégration.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Ici pas de mocks, on construit des domain entities et on les passe à l’adapter pour qu’il le mette en base, et on vérifie depuis la base avec des méthodes de repository qu’on a écrit la bonne chose.</li>
<li class="nx-my-2">Si besoin de données préalables, par exemple pour de la lecture, on exécute d’abord du SQL pour mettre la DB dans un état qui permettra cette lecture.</li>
<li class="nx-my-2">Le fait de ne pas mocker est justifié par le fait qu’on perdrait toute confiance dans nos tests puisque chaque type de DB vient avec ses propres spécificités SQL.</li>
</ul>
</li>
<li class="nx-my-2">Les <strong>chemins principaux complets</strong> sont testés avec des system tests.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On utilise de vrais messages HTTP, et on ne mock rien dans nos couches.</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2">On peut utiliser des fonctions helper pour rendre nos tests plus lisibles en extrayant des bouts de code. Ces fonctions forment un <strong>domain specific language</strong> qu’il est bon de cultiver.</li>
<li class="nx-my-2">Concernant la <strong>quantité de tests</strong> :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">L’auteur suggère d’aller vers du 100% de coverage du code important. Garder quand même le 100% permet de lutter contre la théorie des vitres cassées.</li>
<li class="nx-my-2">Pour mesurer la fiabilité des tests, on peut mesurer <strong>à quel point on est confiant pour mettre en production</strong> notre changement.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Pour être toujours plus confiant, il faut mettre en production souvent.</li>
<li class="nx-my-2">Pour chaque bug en production, il faut se demander ce qu’on aurait pu faire pour qu’un test trouve le bug, et l’ajouter.</li>
<li class="nx-my-2">Le fait de documenter les bugs comme ça permet d’avoir une mesure de la fiabilité des tests dans le temps.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 class="nx-font-semibold nx-tracking-tight nx-mt-10 nx-border-b nx-pb-1 nx-text-3xl contrast-more:nx-border-neutral-400 dark:nx-border-primary-100/10 contrast-more:dark:nx-border-neutral-400">8. Mapping Between Boundaries<span class="nx-absolute -nx-mt-20" id="8-mapping-between-boundaries"></span><a href="#8-mapping-between-boundaries" class="subheading-anchor" aria-label="Permalink for this section"></a></h2>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Les 3 composants principaux (driving adapter, hexagone et driven adapter) doivent avoir un modèle qui leur permet d&#x27;appréhender le système et ses entités. On peut choisir différentes <strong>stratégies de mapping</strong> entre ces modèles en fonction de leur unicité ou de leur différence.</li>
<li class="nx-my-2"><strong>1- La no-mapping strategy</strong> consiste à avoir le même modèle dans l’adapter web, l’hexagone, et l’adapter de persistance.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On n’implémente la représentation des entities qu’une fois pour la réutiliser partout.</li>
<li class="nx-my-2">Chaque couche va avoir besoin de champs ou d’éléments techniques qui lui sont spécifiques, par exemple des annotations liées à HTTP pour l’adapter web, des annotations d’ORM pour l’adapter de persistance. Nos entities auront donc <strong>plusieurs raisons de changer</strong>.</li>
<li class="nx-my-2">Tant que toutes les couches ont besoin des informations formatées de la même manière, cette stratégie marche. C’est le cas pour les <strong>applications CRUD</strong>.</li>
<li class="nx-my-2">A partir du moment où on commence à <strong>gérer des problèmes spécifiques au web ou à la persistance dans l’hexagone</strong>, alors il faut passer à une autre stratégie.</li>
</ul>
</li>
<li class="nx-my-2"><strong>2- La two-way mapping strategy</strong> consiste à avoir un modèle spécifique pour chacun des composants principaux (adapter web, hexagone et adapter de persistance), et de faire un mapping quand la donnée rentre, et un autre quand elle sort.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">L’avantage c’est que cette séparation des modèles permet d’adapter leur structure pour les besoins de chaque couche : besoins web (ex: sérialisation JSON), besoins du modèle, besoins de la persistance (ex: ORM).</li>
<li class="nx-my-2">Le désavantage principal c’est le boilerplate conséquent.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Et même avec l’utilisation de librairies de mapping, les bugs sont compliqués à trouver parce que le mapping est caché.</li>
</ul>
</li>
<li class="nx-my-2">Un autre désavantage c’est que malgré la séparation, les objets du modèle de l’hexagone sont quand même utilisés par les autres couches externes, ce qui fait qu’ils pourraient avoir besoin de changer pour des nécessités de ces couches.</li>
</ul>
</li>
<li class="nx-my-2"><strong>3- La full mapping strategy</strong> consiste à utiliser un mapping entre les 3 composants principaux comme pour la two-way mapping strategy, mais cette fois on va établir des <strong>modèles d’input et d’output fins spécifiques à chaque use-case</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On a encore plus de mapping que si on mappait juste les modèles des 3 composants, mais ce mapping va aussi être plus maintenable parce qu’il sera à chaque fois <strong>spécifique au use-case</strong> sans avoir besoin d’être adapté pour correspondre à de nouveaux besoins.</li>
<li class="nx-my-2">L’auteur conseille ce pattern plutôt entre l’adapter web et l’hexagone qu’entre l’hexagone et l’adapter de persistance (parce qu’il y aurait vraiment trop de mappings).</li>
<li class="nx-my-2">On pourra aussi faire des variantes, par exemple utiliser cette stratégie pour le modèle d’entrée dans l’hexagone depuis l’adapter web, mais renvoyer les objets du modèle de l’hexagone en sortie vers l’adapter web.</li>
</ul>
</li>
<li class="nx-my-2"><strong>4 - La one-way mapping strategy</strong> consiste à avoir une interface commune aux trois modèles de chacun des trois composants.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">De cette manière les objets peuvent être passés sans devoir obligatoirement les mapper. Si le mapping est nécessaire, il suffira à la couche qui en a besoin de le faire.</li>
<li class="nx-my-2">Quand l’objet est passé de l’hexagone vers l’extérieur ils peuvent l’utiliser tel quel sans risquer de le modifier parce que les setters ne sont pas exposés.</li>
<li class="nx-my-2">Quand l’objet passe vers l’hexagone, il devra en général être mappé pour reconstruire le comportement riche du domaine.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On peut le faire avec le pattern Factory du DDD.</li>
</ul>
</li>
<li class="nx-my-2">Cette stratégie a de l’intérêt quand les modèles sont proches.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Le modèle web peut facilement ne pas avoir besoin de mapper l’output venant de l’hexagone.</li>
</ul>
</li>
<li class="nx-my-2">Le désavantage c’est que cette stratégie est plus difficile à appréhender étant donné son caractère non systématique.</li>
</ul>
</li>
<li class="nx-my-2">Il faut <strong>adapter la stratégie</strong> en fonction des cas d’usage et de leur nature, et pas adopter une seule stratégie pour toute la codebase.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On peut avoir des différences de stratégie en fonction :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Des lectures et écritures.</li>
<li class="nx-my-2">De la communication entre adapter web et hexagone, et hexagone et adapter de persistance.</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2">Il ne faut pas avoir peur de <strong>changer de stratégie en cours de route</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">La plupart des applications commencent en étant CRUD, puis soit le restent, soit se complexifient suffisamment pour mériter un changement de stratégie de mapping.</li>
<li class="nx-my-2">L’équipe doit se mettre d’accord sur des stratégies à choisir pour chaque partie de la codebase, et surtout <strong>noter pourquoi elle fait ce choix</strong> pour pouvoir réévaluer plus tard si le choix doit être modifié ou non.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Il peut être intéressant aussi de noter dans quel cas elle prévoit de changer de stratégie.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 class="nx-font-semibold nx-tracking-tight nx-mt-10 nx-border-b nx-pb-1 nx-text-3xl contrast-more:nx-border-neutral-400 dark:nx-border-primary-100/10 contrast-more:dark:nx-border-neutral-400">9 - Assembling the Application<span class="nx-absolute -nx-mt-20" id="9---assembling-the-application"></span><a href="#9---assembling-the-application" class="subheading-anchor" aria-label="Permalink for this section"></a></h2>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Nous voulons garder l’inversion de dépendance entre les composants externes et l’hexagone.</p>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Donc nous devons instancier les adapters pour les donner au constructeur des objets de l’hexagone par le mécanisme qui s’appelle l&#x27;<strong>injection de dépendance</strong>.</li>
</ul>
</li>
<li class="nx-my-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Nous devons avoir un <strong>composant de configuration</strong> qui soit neutre du point de vue notre architecture, et qui ait <strong>accès à tous les composants</strong> pour les instancier.</p>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Il va :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Créer les adapters web et s’assurer que les requêtes HTTP sont câblées aux bons adapters.</li>
<li class="nx-my-2">Créer les adapters de persistance et s’assurer qu’elles aient accès à la base de données.</li>
<li class="nx-my-2">Créer les use cases, et au moment de leur création, leur donner les adapters web et les adapters de persistance dans leur constructeur, pour qu’elles y aient accès (injection de dépendance).</li>
</ul>
</li>
<li class="nx-my-2">Il va aussi passer certaines valeurs de configuration aux autres composants (serveur de base de données, serveur SMTP etc).</li>
<li class="nx-my-2">Il aura toutes les raisons de changer</li>
</ul>
</li>
<li class="nx-my-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Côté implémentation :</p>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">On peut créer le composant avec du <strong>code sans librairie</strong> :</p>
<div data-rehype-pretty-code-fragment=""><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-font-medium nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4 "><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10  " dir="ltr" data-language="typescript" data-theme="default"><span class="line"><span style="color:var(--shiki-token-keyword)">function</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">main</span><span style="color:var(--shiki-color-text)">() {</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-keyword)">const</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">accountRepository</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">new</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">AccountRepository</span><span style="color:var(--shiki-color-text)">();</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-keyword)">const</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">activityRepository</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">new</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">ActivityRepository</span><span style="color:var(--shiki-color-text)">();</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-keyword)">const</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">accountPersistanceAdapter</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">new</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">AccountPersistanceAdapter</span><span style="color:var(--shiki-color-text)">(</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    acountRepository</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    activityRepository</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  );</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-keyword)">const</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">sendMoneyUseCase</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">new</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">SendMoneyService</span><span style="color:var(--shiki-color-text)">(accountPersistanceAdapter);</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-keyword)">const</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">sendMoneyController</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">new</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">SendMoneyController</span><span style="color:var(--shiki-color-text)">(sendMoneyUseCase);</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-function)">startProcessingWebRequests</span><span style="color:var(--shiki-color-text)">(sendMoneyController);</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">}</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button></div></div>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Cette méthode a le désavantage d’amener à écrire beaucoup de code, et d’obliger à ce que les classes de chaque composant soient accessibles publiquement.</li>
</ul>
</li>
<li class="nx-my-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Parmi les techniques impliquant une librairie, en Java on a</p>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Le classpath scanning où il s’agit d’annoter les classes de chaque composant et demander à Spring de scanner les classes pour trouver celles qu’il faut instancier et injecter.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Elle est plus rapide mais peut mener à des bugs difficiles à trouver parce que le système de scanning est obscur.</li>
</ul>
</li>
<li class="nx-my-2">L’autre méthode c’est d’écrire des classes de configuration qui vont indiquer quelles classes doivent être instanciées et injectées.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On va écrire plus de code pour obtenir plus de découplage et de transparence sur ce qui est fait.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 class="nx-font-semibold nx-tracking-tight nx-mt-10 nx-border-b nx-pb-1 nx-text-3xl contrast-more:nx-border-neutral-400 dark:nx-border-primary-100/10 contrast-more:dark:nx-border-neutral-400">10 - Enforcing Architecture Boundaries<span class="nx-absolute -nx-mt-20" id="10---enforcing-architecture-boundaries"></span><a href="#10---enforcing-architecture-boundaries" class="subheading-anchor" aria-label="Permalink for this section"></a></h2>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Ce chapitre traite de la manière d’éviter que l’architecture choisie s’érode au fil du temps, causant un manque de clarté et une lenteur à faire des changements.</li>
<li class="nx-my-2">La principale chose à faire respecter est le <strong>sens des dépendances</strong> parmi les couches (<code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10  " dir="ltr">domaine -&gt; application -&gt; adapters -&gt; configuration</code>).</li>
<li class="nx-my-2">On peut utiliser la <strong>visibilité de package,</strong> si le langage le permet (<em>package-private modifier</em> en Java), pour rendre le contenu des couches plus cohésives.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Si on part du principe que notre composant de configuration est une librairie qui passe outre la visibilité de package et qu’elle peut instancier même les classes privées à leur package, alors on n’a que les relations entre couches à se préoccuper :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Les <strong>adapters et les use cases peuvent être privés</strong> au package de leur couche.</li>
<li class="nx-my-2">Les <strong>entities du domaine doivent être publiques</strong> pour être accédées par les couches du dessus, <strong>de même que les ports</strong> qui doivent être accédés par les adapters qui les implémentent.</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2">On peut aussi utiliser des <strong>moyens au runtime</strong> pour empêcher que le sens des dépendances s’inverse, par exemple <strong>au moment des tests</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">En Java il y a la librairie ArchUnit qui permet de faire des tests d’architecture, y compris des tests sur le sens des dépendances, en vérifiant qu’un package ne dépend pas d’un autre package (importe rien qui vienne de lui).</li>
<li class="nx-my-2">On peut construire par dessus ce genre de librairie pour obtenir un DSL (Domain Specific Language) dans nos tests, qui vérifie les dépendances pour un bounded context donné :<!-- -->
<div data-rehype-pretty-code-fragment=""><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-font-medium nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4 "><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10  " dir="ltr" data-language="java" data-theme="default"><span class="line"><span style="color:var(--shiki-token-constant)">HexagonalArchitecture</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">boundedContext</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-string-expression)">&quot;account&quot;</span><span style="color:var(--shiki-color-text)">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">withDomainLayer</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-string-expression)">&quot;domain&quot;</span><span style="color:var(--shiki-color-text)">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">withAdaptersLayer</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-string-expression)">&quot;adapter&quot;</span><span style="color:var(--shiki-color-text)">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">incoming</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-string-expression)">&quot;web&quot;</span><span style="color:var(--shiki-color-text)">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">outgoing</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-string-expression)">&quot;persistence&quot;</span><span style="color:var(--shiki-color-text)">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">and</span><span style="color:var(--shiki-color-text)">()</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">withApplicationLayer</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-string-expression)">&quot;application&quot;</span><span style="color:var(--shiki-color-text)">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">services</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-string-expression)">&quot;service&quot;</span><span style="color:var(--shiki-color-text)">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">incomingPorts</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-string-expression)">&quot;port.in&quot;</span><span style="color:var(--shiki-color-text)">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">outgoingPorts</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-string-expression)">&quot;port.out&quot;</span><span style="color:var(--shiki-color-text)">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">and</span><span style="color:var(--shiki-color-text)">()</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">withConfiguration</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-string-expression)">&quot;configuration&quot;</span><span style="color:var(--shiki-color-text)">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">check</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-keyword)">new</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">ClassFileImporter()</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">importPackages</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-string-expression)">&quot;buckpal&quot;</span><span style="color:var(--shiki-color-text)">));</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">}</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button></div></div>
</li>
<li class="nx-my-2">Attention par contre : ce genre de test est vulnérable aux refactorings. Il suffit que le nom des packages change et aucun problème ne sera trouvé sur des packages qui n’existent pas.</li>
</ul>
</li>
<li class="nx-my-2">On peut enfin profiter de la <strong>phase de build</strong> de notre application pour créer autant d’artefacts de build que nécessaire, et profiter de l’outil de build pour garantir les limites des composants de notre architecture.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On peut découper avec diverses granularités :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Une première solution c’est de faire 3 groupes de build : la configuration, les adapters, et l’application (hexagone).</li>
<li class="nx-my-2">On peut décider de séparer les types d’adapter pour qu’ils restent autonomes.</li>
<li class="nx-my-2">Un cran plus loin encore, on peut isoler les ports dans une unité à part. De cette manière on empêche la no mapping strategy.</li>
<li class="nx-my-2">On peut enfin aussi séparer les types entrants et sortants des ports pour plus de clarté, et séparer le domaine et l’application service dans deux unités pour empêcher le domaine d’accéder aux use cases.</li>
</ul>
</li>
<li class="nx-my-2">Un des avantages c’est que l’outil de build nous empêchera d’avoir des dépendances circulaires entre nos unités de build, améliorant l’aspect single responsibility de nos modules.</li>
<li class="nx-my-2">Être obligé de maintenir un script de build permet aussi de faire des choix en conscience pour ce qui est du placement des diverses classes.</li>
<li class="nx-my-2">D’un autre côté c’est un certain travail de maintenance quand même, donc il vaut mieux que l’<strong>architecture soit un minimum stable d’abord</strong>.</li>
</ul>
</li>
<li class="nx-my-2">L’idée c’est de combiner les trois méthodes pour avoir une architecture solide dans le temps.</li>
<li class="nx-my-2">A noter que plus on découpe finement, plus on devra faire de mappings.</li>
</ul>
<h2 class="nx-font-semibold nx-tracking-tight nx-mt-10 nx-border-b nx-pb-1 nx-text-3xl contrast-more:nx-border-neutral-400 dark:nx-border-primary-100/10 contrast-more:dark:nx-border-neutral-400">11 - Taking Shortcuts Consciously<span class="nx-absolute -nx-mt-20" id="11---taking-shortcuts-consciously"></span><a href="#11---taking-shortcuts-consciously" class="subheading-anchor" aria-label="Permalink for this section"></a></h2>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Les raccourcis doivent être connus et compris pour être évités dans le but de garantir l&#x27;intégrité de l’architecture, et dans certains cas acceptés en toute conscience.</li>
<li class="nx-my-2">La <strong>théorie des vitres cassées</strong> vient d’un psychologue (Philip Zimbardo) qui a conduit une expérience en laissant une voiture dans un quartier chaud, et une autre dans un quartier chic.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">La première a été désossée rapidement puis les passants ont commencé à la dégrader.</li>
<li class="nx-my-2">La 2ème a été laissée intacte pendant une semaine. Puis le psychologue a cassé une de ses vitres, et à partir de là elle a été dégradée aussi vite que la première, par des gens de tout type.</li>
<li class="nx-my-2">L’idée est de dire que nous avons une tendance naturelle à en rajouter quand les choses sont déjà en mauvais état ou mal rangées. La même chose s’applique au code et à son architecture.</li>
</ul>
</li>
<li class="nx-my-2">Il est de la responsabilité des développeurs de garder <strong>l’architecture la plus clean possible dès le début</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On peut cependant prendre des <strong>raccourcis choisis en conscience</strong>, faire des compromis qu’on assume.</li>
<li class="nx-my-2">Pour que l’effet des vitres cassées soit limité, il faut <strong>documenter les raccourcis choisis</strong> par l’équipe dans des ADR (architecture Decision Record).</li>
</ul>
</li>
<li class="nx-my-2">Parmi les raccourcis possible dans l’architecture hexagonale on a :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Utiliser le <strong>même modèle pour les inputs (ou les outputs) de deux use cases</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">La question à se poser est : est-ce que ces deux use cases sont voués à <strong>évoluer ensemble</strong> ou non ?</li>
<li class="nx-my-2">Si oui alors il faut que leurs inputs et leurs outputs aient des modèles séparés. Si non alors on peut (et on doit) les coupler au niveau de leurs inputs et outputs.</li>
<li class="nx-my-2">Il ne faut donc pas oublier de régulièrement reconsidérer si deux use cases imaginés comme voués à évoluer ensemble, ne doivent pas être désormais considérés de manière séparée.</li>
</ul>
</li>
<li class="nx-my-2">Utiliser des <strong>entities du domaine comme modèles d’entrée ou de sortie de la couche applicative</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Il s’agit d’avoir les ports gauches (l’entrée et la sortie depuis l’adapter web vers l’hexagone) basés sur des domain entities.</li>
<li class="nx-my-2">En faisant ça on va être tenté d’ajouter des champs à l’entity du domaine à chaque fois qu’on en aura besoin dans notre input ou output de la couche applicative. Donc le domaine va dans une certaine mesure dépendre de l’application..</li>
<li class="nx-my-2">C’est <strong>OK de le faire si on est sur des use cases simple type create/update</strong> parce que dans ce cas c’est bien le contenu exact des domain entities qu’on veut.</li>
<li class="nx-my-2">Il ne faut pas oublier de reconsidérer régulièrement les use cases où on l’a fait et qui se sont complexifiés.</li>
</ul>
</li>
<li class="nx-my-2"><strong>Ne pas utiliser de ports entrants pour l’adapter web</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Le sens du flow étant le même que le sens des appels pour l’adapter web, on peut très bien lui permettre d’appeler directement les use cases, sans passer par une interface.</li>
<li class="nx-my-2">On perd alors la clarté des points d’entrée qui ne sautent plus aux yeux aussi bien qu’avec des ports explicites.</li>
<li class="nx-my-2">On ne peut plus non plus utiliser des moyens pour forcer l’hexagone à ne pas dépendre de l’adapter web.</li>
<li class="nx-my-2">Cette technique est donc à réserver aux <strong>petites applications, ou celles qui n’ont qu’un adapter web</strong>.</li>
</ul>
</li>
<li class="nx-my-2"><strong>Ne pas créer d’application service</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Parfois l&#x27;application service ne fait rien à part appeler une méthode dans l’adapter de persistance et retourner son résultat à l’adapter web. Dans ce cas, on peut laisser l’adapter web appeler directement l’adapter de persistance.</li>
<li class="nx-my-2">C’est le cas quand on a des <strong>use cases CRUD</strong>.</li>
<li class="nx-my-2">On a alors nos domain entities qui sont passés entre adapters gauches et droits.</li>
<li class="nx-my-2">Le <strong>danger c’est que si la fonctionnalité se complexifie</strong>, la logique métier sera ajoutée dans l’adapter de persistance. Il faut dans ce cas absolument créer un application service.</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2">La plupart des raccourcis sont adaptés aux fonctionnalités simples de type CRUD. On commence en général comme ça, et on réévalue les raccourcis si l’application se complexifie. Si elle reste simple on pourra garder les raccourcis.</li>
</ul>
<h2 class="nx-font-semibold nx-tracking-tight nx-mt-10 nx-border-b nx-pb-1 nx-text-3xl contrast-more:nx-border-neutral-400 dark:nx-border-primary-100/10 contrast-more:dark:nx-border-neutral-400">12 - Deciding on an Architecture Style<span class="nx-absolute -nx-mt-20" id="12---deciding-on-an-architecture-style"></span><a href="#12---deciding-on-an-architecture-style" class="subheading-anchor" aria-label="Permalink for this section"></a></h2>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">La question dans ce chapitre est : quand est-ce qu’il faut utiliser l’architecture hexagonale ?<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">La première chose c’est que <strong>cette architecture met le domaine au centre</strong> et l’isole du reste, pour pouvoir travailler dessus.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Si on n’a pas besoin de ça, on n’a sans doute pas besoin d’architecture hexagonale.</li>
<li class="nx-my-2">Ça va bien avec le DDD.</li>
</ul>
</li>
<li class="nx-my-2">La deuxième chose c’est qu’il faut <strong>expérimenter</strong> cette architecture au moins sur un module de notre application, pour voir ce qu’elle apporte et voir où est-ce qu’on peut l’utiliser.</li>
<li class="nx-my-2">Et enfin la 3ème chose c’est que le choix de l’architecture <strong>dépend de nombreux critères</strong> :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Le type du logiciel.</li>
<li class="nx-my-2">Le rôle du domaine dans le code.</li>
<li class="nx-my-2">L’expérience de l’équipe.</li>
<li class="nx-my-2">etc.</li>
<li class="nx-my-2">NDLR : l’auteur ne se mouille pas beaucoup.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Pour info Vlad Khononov conseille dans Learning Domain Driven Design l’heuristique d’adopter l’architecture hexagonale dans le cas où on a un code subdomain et qu’on choisit les patterns tactiques du DDD, et d’adopter une architecture en couches sinon.</li>
<li class="nx-my-2">On peut imaginer qu’étant donné que l’auteur donne des raccourcis pour les use cases CRUD, y compris ceux qui resteront CRUD, il serait pour privilégier l’usage de l’architecture hexagonale la plupart du temps, en modulant avec ces raccourcis.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul><div class="nx-mt-16"></div><div class="nx-mb-8 nx-flex nx-items-center nx-border-t nx-pt-8 dark:nx-border-neutral-800 contrast-more:nx-border-neutral-400 dark:contrast-more:nx-border-neutral-400"><a title="Designing Data-Intensive Applications" class="nx-flex nx-max-w-[50%] nx-items-center nx-gap-1 nx-py-4 nx-text-base nx-font-medium nx-text-gray-600 nx-transition-colors [word-break:break-word] hover:nx-text-primary-600 dark:nx-text-gray-300 md:nx-text-lg ltr:nx-pr-4 rtl:nx-pl-4" href="/reading-notes/books/designing-data-intensive-applications/"><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="nx-inline nx-h-5 nx-shrink-0 ltr:nx-rotate-180"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>Designing Data-Intensive Applications</a><a title="The Design of Web APIs" class="nx-flex nx-max-w-[50%] nx-items-center nx-gap-1 nx-py-4 nx-text-base nx-font-medium nx-text-gray-600 nx-transition-colors [word-break:break-word] hover:nx-text-primary-600 dark:nx-text-gray-300 md:nx-text-lg ltr:nx-ml-auto ltr:nx-pl-4 ltr:nx-text-right rtl:nx-mr-auto rtl:nx-pr-4 rtl:nx-text-left" href="/reading-notes/books/the-design-of-web-apis/">The Design of Web APIs<svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="nx-inline nx-h-5 nx-shrink-0 rtl:nx-rotate-180"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg></a></div></main></article></div><footer class="nx-bg-gray-100 nx-pb-[env(safe-area-inset-bottom)] dark:nx-bg-neutral-900"><div class="nx-mx-auto nx-flex nx-max-w-[90rem] nx-gap-2 nx-py-2 nx-px-4 nx-hidden"><div class="nx-relative"><button title="Change theme" class="nx-h-7 nx-rounded-md nx-px-2 nx-text-left nx-text-xs nx-font-medium nx-text-gray-600 nx-transition-colors dark:nx-text-gray-400 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50" id="headlessui-listbox-button-:Rkt6:" type="button" aria-haspopup="true" aria-expanded="false" data-headlessui-state=""><div class="nx-flex nx-items-center nx-gap-2 nx-capitalize"><svg fill="none" viewBox="3 3 18 18" width="12" height="12" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" fill="currentColor" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg><span class="">light</span></div></button></div></div><hr class="dark:nx-border-neutral-800"/><div class="nx-mx-auto nx-flex nx-max-w-[90rem] nx-justify-center nx-py-12 nx-text-gray-600 dark:nx-text-gray-400 md:nx-justify-start nx-pl-[max(env(safe-area-inset-left),1.5rem)] nx-pr-[max(env(safe-area-inset-right),1.5rem)]">Made by Roman Mkrtchian</div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/books/get-your-hands-dirty-on-clean-architecture","query":{},"buildId":"fSnU8rZPKXAFKq-757ygu","assetPrefix":"/reading-notes","nextExport":true,"autoExport":true,"isFallback":false,"scriptLoader":[]}</script></body></html>